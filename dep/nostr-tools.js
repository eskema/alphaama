var NostrTools=(()=>{var dn=Object.defineProperty;var gi=Object.getOwnPropertyDescriptor;var yi=Object.getOwnPropertyNames;var wi=Object.prototype.hasOwnProperty;var Lr=(t,e)=>{for(var n in e)dn(t,n,{get:e[n],enumerable:!0})},bi=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of yi(e))!wi.call(t,o)&&o!==n&&dn(t,o,{get:()=>e[o],enumerable:!(r=gi(e,o))||r.enumerable});return t};var mi=t=>bi(dn({},"__esModule",{value:!0}),t);var Vf={};Lr(Vf,{Relay:()=>ds,SimplePool:()=>kl,finalizeEvent:()=>pt,fj:()=>is,generateSecretKey:()=>zo,getEventHash:()=>xe,getFilterLimit:()=>vl,getPublicKey:()=>sn,kinds:()=>Do,matchFilter:()=>os,matchFilters:()=>ss,mergeFilters:()=>El,nip04:()=>ws,nip05:()=>xs,nip10:()=>vs,nip11:()=>As,nip13:()=>Ss,nip17:()=>Ls,nip18:()=>Ds,nip19:()=>gs,nip21:()=>Ks,nip25:()=>Zs,nip27:()=>Gs,nip28:()=>Js,nip30:()=>Xs,nip39:()=>Fs,nip42:()=>ls,nip44:()=>ks,nip47:()=>Qs,nip54:()=>ti,nip57:()=>ei,nip59:()=>Is,nip77:()=>ni,nip98:()=>ii,parseReferences:()=>Vl,serializeEvent:()=>jo,sortEvents:()=>Ka,utils:()=>Mo,validateEvent:()=>rn,verifiedSymbol:()=>Wt,verifyEvent:()=>de});function Ir(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function pn(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function kr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ir(t.outputLen),Ir(t.blockLen)}function re(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ur(t,e){pn(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ae=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Rr=t=>t instanceof Uint8Array;var Be=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ft=(t,e)=>t<<32-e|t>>>e,xi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!xi)throw new Error("Non little-endian hardware is not supported");function Ei(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function pe(t){if(typeof t=="string"&&(t=Ei(t)),!Rr(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Or(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!Rr(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var oe=class{clone(){return this._cloneInto()}},Kf={}.toString;function Nr(t){let e=r=>t().update(pe(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Se(t=32){if(Ae&&typeof Ae.getRandomValues=="function")return Ae.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function vi(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}var _e=class extends oe{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Be(this.buffer)}update(e){re(this);let{view:n,buffer:r,blockLen:o}=this;e=pe(e);let s=e.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Be(e);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){re(this),Ur(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;vi(r,o-8,BigInt(this.length*8),s),this.process(r,0);let a=Be(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return e.length=o,e.pos=a,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var Ai=(t,e,n)=>t&e^~t&n,Bi=(t,e,n)=>t&e^t&n^e&n,Si=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Rt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ot=new Uint32Array(64),gn=class extends _e{constructor(){super(64,32,8,!1),this.A=Rt[0]|0,this.B=Rt[1]|0,this.C=Rt[2]|0,this.D=Rt[3]|0,this.E=Rt[4]|0,this.F=Rt[5]|0,this.G=Rt[6]|0,this.H=Rt[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[e,n,r,o,s,i,a,c]}set(e,n,r,o,s,i,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(e,n){for(let u=0;u<16;u++,n+=4)Ot[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let p=Ot[u-15],y=Ot[u-2],g=ft(p,7)^ft(p,18)^p>>>3,h=ft(y,17)^ft(y,19)^y>>>10;Ot[u]=h+Ot[u-7]+g+Ot[u-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){let p=ft(a,6)^ft(a,11)^ft(a,25),y=f+p+Ai(a,c,l)+Si[u]+Ot[u]|0,h=(ft(r,2)^ft(r,13)^ft(r,22))+Bi(r,o,s)|0;f=l,l=c,c=a,a=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,l,f)}roundClean(){Ot.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Te=Nr(()=>new gn);var mn={};Lr(mn,{bitGet:()=>Ri,bitLen:()=>Ui,bitMask:()=>ge,bitSet:()=>Oi,bytesToHex:()=>Kt,bytesToNumberBE:()=>J,bytesToNumberLE:()=>ke,concatBytes:()=>Et,createHmacDrbg:()=>bn,ensureBytes:()=>W,equalBytes:()=>Ii,hexToBytes:()=>Zt,hexToNumber:()=>wn,numberToBytesBE:()=>ut,numberToBytesLE:()=>Ue,numberToHexUnpadded:()=>Pr,numberToVarBytesBE:()=>Li,utf8ToBytes:()=>ki,validateObject:()=>Nt});var Hr=BigInt(0),Le=BigInt(1),_i=BigInt(2),Ie=t=>t instanceof Uint8Array,Ti=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Kt(t){if(!Ie(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Ti[t[n]];return e}function Pr(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function wn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Zt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function J(t){return wn(Kt(t))}function ke(t){if(!Ie(t))throw new Error("Uint8Array expected");return wn(Kt(Uint8Array.from(t).reverse()))}function ut(t,e){return Zt(t.toString(16).padStart(e*2,"0"))}function Ue(t,e){return ut(t,e).reverse()}function Li(t){return Zt(Pr(t))}function W(t,e,n){let r;if(typeof e=="string")try{r=Zt(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Ie(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function Et(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!Ie(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function Ii(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ki(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ui(t){let e;for(e=0;t>Hr;t>>=Le,e+=1);return e}function Ri(t,e){return t>>BigInt(e)&Le}var Oi=(t,e,n)=>t|(n?Le:Hr)<<BigInt(e),ge=t=>(_i<<BigInt(t-1))-Le,yn=t=>new Uint8Array(t),Cr=t=>Uint8Array.from(t);function bn(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=yn(t),o=yn(t),s=0,i=()=>{r.fill(1),o.fill(0),s=0},a=(...u)=>n(o,r,...u),c=(u=yn())=>{o=a(Cr([0]),u),r=a(),u.length!==0&&(o=a(Cr([1]),u),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0,p=[];for(;u<e;){r=a();let y=r.slice();p.push(y),u+=r.length}return Et(...p)};return(u,p)=>{i(),c(u);let y;for(;!(y=p(l()));)c();return i(),y}}var Ni={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Nt(t,e,n={}){let r=(o,s,i)=>{let a=Ni[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);let c=t[o];if(!(i&&c===void 0)&&!a(c,t))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(let[o,s]of Object.entries(e))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return t}var Z=BigInt(0),z=BigInt(1),Gt=BigInt(2),Ci=BigInt(3),xn=BigInt(4),$r=BigInt(5),Mr=BigInt(8),Hi=BigInt(9),Pi=BigInt(16);function K(t,e){let n=t%e;return n>=Z?n:e+n}function $i(t,e,n){if(n<=Z||e<Z)throw new Error("Expected power/modulo > 0");if(n===z)return Z;let r=z;for(;e>Z;)e&z&&(r=r*t%n),t=t*t%n,e>>=z;return r}function nt(t,e,n){let r=t;for(;e-- >Z;)r*=r,r%=n;return r}function Re(t,e){if(t===Z||e<=Z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=K(t,e),r=e,o=Z,s=z,i=z,a=Z;for(;n!==Z;){let l=r/n,f=r%n,u=o-i*l,p=s-a*l;r=n,n=f,o=i,s=a,i=u,a=p}if(r!==z)throw new Error("invert: does not exist");return K(o,e)}function Mi(t){let e=(t-z)/Gt,n,r,o;for(n=t-z,r=0;n%Gt===Z;n/=Gt,r++);for(o=Gt;o<t&&$i(o,e,t)!==t-z;o++);if(r===1){let i=(t+z)/xn;return function(c,l){let f=c.pow(l,i);if(!c.eql(c.sqr(f),l))throw new Error("Cannot find square root");return f}}let s=(n+z)/Gt;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,f=a.pow(a.mul(a.ONE,o),n),u=a.pow(c,s),p=a.pow(c,n);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let y=1;for(let h=a.sqr(p);y<l&&!a.eql(h,a.ONE);y++)h=a.sqr(h);let g=a.pow(f,z<<BigInt(l-y-1));f=a.sqr(g),u=a.mul(u,g),p=a.mul(p,f),l=y}return u}}function qi(t){if(t%xn===Ci){let e=(t+z)/xn;return function(r,o){let s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%Mr===$r){let e=(t-$r)/Mr;return function(r,o){let s=r.mul(o,Gt),i=r.pow(s,e),a=r.mul(o,i),c=r.mul(r.mul(a,Gt),i),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),o))throw new Error("Cannot find square root");return l}}return t%Pi,Mi(t)}var Vi=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function En(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Vi.reduce((r,o)=>(r[o]="function",r),e);return Nt(t,n)}function ji(t,e,n){if(n<Z)throw new Error("Expected power > 0");if(n===Z)return t.ONE;if(n===z)return e;let r=t.ONE,o=e;for(;n>Z;)n&z&&(r=t.mul(r,o)),o=t.sqr(o),n>>=z;return r}function zi(t,e){let n=new Array(e.length),r=e.reduce((s,i,a)=>t.is0(i)?s:(n[a]=s,t.mul(s,i)),t.ONE),o=t.inv(r);return e.reduceRight((s,i,a)=>t.is0(i)?s:(n[a]=t.mul(s,n[a]),t.mul(s,i)),o),n}function vn(t,e){let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function qr(t,e,n=!1,r={}){if(t<=Z)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:o,nByteLength:s}=vn(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=qi(t),a=Object.freeze({ORDER:t,BITS:o,BYTES:s,MASK:ge(o),ZERO:Z,ONE:z,create:c=>K(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Z<=c&&c<t},is0:c=>c===Z,isOdd:c=>(c&z)===z,neg:c=>K(-c,t),eql:(c,l)=>c===l,sqr:c=>K(c*c,t),add:(c,l)=>K(c+l,t),sub:(c,l)=>K(c-l,t),mul:(c,l)=>K(c*l,t),pow:(c,l)=>ji(a,c,l),div:(c,l)=>K(c*Re(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Re(c,t),sqrt:r.sqrt||(c=>i(a,c)),invertBatch:c=>zi(a,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>n?Ue(c,s):ut(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?ke(c):J(c)}});return Object.freeze(a)}function Vr(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function An(t){let e=Vr(t);return e+Math.ceil(e/2)}function jr(t,e,n=!1){let r=t.length,o=Vr(e),s=An(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);let i=n?J(t):ke(t),a=K(i,e-z)+z;return n?Ue(a,o):ut(a,o)}var Wi=BigInt(0),Bn=BigInt(1);function zr(t,e){let n=(o,s)=>{let i=s.negate();return o?i:s},r=o=>{let s=Math.ceil(e/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=t.ZERO,a=o;for(;s>Wi;)s&Bn&&(i=i.add(a)),a=a.double(),s>>=Bn;return i},precomputeWindow(o,s){let{windows:i,windowSize:a}=r(s),c=[],l=o,f=l;for(let u=0;u<i;u++){f=l,c.push(f);for(let p=1;p<a;p++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,i){let{windows:a,windowSize:c}=r(o),l=t.ZERO,f=t.BASE,u=BigInt(2**o-1),p=2**o,y=BigInt(o);for(let g=0;g<a;g++){let h=g*c,d=Number(i&u);i>>=y,d>c&&(d-=p,i+=Bn);let w=h,b=h+Math.abs(d)-1,x=g%2!==0,A=d<0;d===0?f=f.add(n(x,s[w])):l=l.add(n(A,s[b]))}return{p:l,f}},wNAFCached(o,s,i,a){let c=o._WINDOW_SIZE||1,l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,a(l))),this.wNAF(c,l,i)}}}function Sn(t){return En(t.Fp),Nt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...vn(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Ki(t){let e=Sn(t);Nt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:Zi,hexToBytes:Gi}=mn,Jt={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=Jt;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:Zi(r),l:t.subarray(n+2)}},toSig(t){let{Err:e}=Jt,n=typeof t=="string"?Gi(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");let{d:o,l:s}=Jt._parseInt(n.subarray(2)),{d:i,l:a}=Jt._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(t){let e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let f=l.toString(16);return f.length&1?`0${f}`:f},r=e(n(t.s)),o=e(n(t.r)),s=r.length/2,i=o.length/2,a=n(s),c=n(i);return`30${n(i+s+4)}02${c}${o}02${a}${r}`}},vt=BigInt(0),st=BigInt(1),au=BigInt(2),Dr=BigInt(3),cu=BigInt(4);function Ji(t){let e=Ki(t),{Fp:n}=e,r=e.toBytes||((g,h,d)=>{let w=h.toAffine();return Et(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=e.fromBytes||(g=>{let h=g.subarray(1),d=n.fromBytes(h.subarray(0,n.BYTES)),w=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:d,y:w}});function s(g){let{a:h,b:d}=e,w=n.sqr(g),b=n.mul(w,g);return n.add(n.add(b,n.mul(g,h)),d)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function i(g){return typeof g=="bigint"&&vt<g&&g<e.n}function a(g){if(!i(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(g){let{allowedPrivateKeyLengths:h,nByteLength:d,wrapPrivateKey:w,n:b}=e;if(h&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Kt(g)),typeof g!="string"||!h.includes(g.length))throw new Error("Invalid key");g=g.padStart(d*2,"0")}let x;try{x=typeof g=="bigint"?g:J(W("private key",g,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof g}`)}return w&&(x=K(x,b)),a(x),x}let l=new Map;function f(g){if(!(g instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(h,d,w){if(this.px=h,this.py=d,this.pz=w,h==null||!n.isValid(h))throw new Error("x required");if(d==null||!n.isValid(d))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(h){let{x:d,y:w}=h||{};if(!h||!n.isValid(d)||!n.isValid(w))throw new Error("invalid affine point");if(h instanceof u)throw new Error("projective point not allowed");let b=x=>n.eql(x,n.ZERO);return b(d)&&b(w)?u.ZERO:new u(d,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let d=n.invertBatch(h.map(w=>w.pz));return h.map((w,b)=>w.toAffine(d[b])).map(u.fromAffine)}static fromHex(h){let d=u.fromAffine(o(W("pointHex",h)));return d.assertValidity(),d}static fromPrivateKey(h){return u.BASE.multiply(c(h))}_setWindowSize(h){this._WINDOW_SIZE=h,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:h,y:d}=this.toAffine();if(!n.isValid(h)||!n.isValid(d))throw new Error("bad point: x or y not FE");let w=n.sqr(d),b=s(h);if(!n.eql(w,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);let{px:d,py:w,pz:b}=this,{px:x,py:A,pz:I}=h,B=n.eql(n.mul(d,I),n.mul(x,b)),S=n.eql(n.mul(w,I),n.mul(A,b));return B&&S}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){let{a:h,b:d}=e,w=n.mul(d,Dr),{px:b,py:x,pz:A}=this,I=n.ZERO,B=n.ZERO,S=n.ZERO,T=n.mul(b,b),O=n.mul(x,x),U=n.mul(A,A),k=n.mul(b,x);return k=n.add(k,k),S=n.mul(b,A),S=n.add(S,S),I=n.mul(h,S),B=n.mul(w,U),B=n.add(I,B),I=n.sub(O,B),B=n.add(O,B),B=n.mul(I,B),I=n.mul(k,I),S=n.mul(w,S),U=n.mul(h,U),k=n.sub(T,U),k=n.mul(h,k),k=n.add(k,S),S=n.add(T,T),T=n.add(S,T),T=n.add(T,U),T=n.mul(T,k),B=n.add(B,T),U=n.mul(x,A),U=n.add(U,U),T=n.mul(U,k),I=n.sub(I,T),S=n.mul(U,O),S=n.add(S,S),S=n.add(S,S),new u(I,B,S)}add(h){f(h);let{px:d,py:w,pz:b}=this,{px:x,py:A,pz:I}=h,B=n.ZERO,S=n.ZERO,T=n.ZERO,O=e.a,U=n.mul(e.b,Dr),k=n.mul(d,x),P=n.mul(w,A),$=n.mul(b,I),V=n.add(d,w),m=n.add(x,A);V=n.mul(V,m),m=n.add(k,P),V=n.sub(V,m),m=n.add(d,b);let E=n.add(x,I);return m=n.mul(m,E),E=n.add(k,$),m=n.sub(m,E),E=n.add(w,b),B=n.add(A,I),E=n.mul(E,B),B=n.add(P,$),E=n.sub(E,B),T=n.mul(O,m),B=n.mul(U,$),T=n.add(B,T),B=n.sub(P,T),T=n.add(P,T),S=n.mul(B,T),P=n.add(k,k),P=n.add(P,k),$=n.mul(O,$),m=n.mul(U,m),P=n.add(P,$),$=n.sub(k,$),$=n.mul(O,$),m=n.add(m,$),k=n.mul(P,m),S=n.add(S,k),k=n.mul(E,m),B=n.mul(V,B),B=n.sub(B,k),k=n.mul(V,P),T=n.mul(E,T),T=n.add(T,k),new u(B,S,T)}subtract(h){return this.add(h.negate())}is0(){return this.equals(u.ZERO)}wNAF(h){return y.wNAFCached(this,l,h,d=>{let w=n.invertBatch(d.map(b=>b.pz));return d.map((b,x)=>b.toAffine(w[x])).map(u.fromAffine)})}multiplyUnsafe(h){let d=u.ZERO;if(h===vt)return d;if(a(h),h===st)return this;let{endo:w}=e;if(!w)return y.unsafeLadder(this,h);let{k1neg:b,k1:x,k2neg:A,k2:I}=w.splitScalar(h),B=d,S=d,T=this;for(;x>vt||I>vt;)x&st&&(B=B.add(T)),I&st&&(S=S.add(T)),T=T.double(),x>>=st,I>>=st;return b&&(B=B.negate()),A&&(S=S.negate()),S=new u(n.mul(S.px,w.beta),S.py,S.pz),B.add(S)}multiply(h){a(h);let d=h,w,b,{endo:x}=e;if(x){let{k1neg:A,k1:I,k2neg:B,k2:S}=x.splitScalar(d),{p:T,f:O}=this.wNAF(I),{p:U,f:k}=this.wNAF(S);T=y.constTimeNegate(A,T),U=y.constTimeNegate(B,U),U=new u(n.mul(U.px,x.beta),U.py,U.pz),w=T.add(U),b=O.add(k)}else{let{p:A,f:I}=this.wNAF(d);w=A,b=I}return u.normalizeZ([w,b])[0]}multiplyAndAddUnsafe(h,d,w){let b=u.BASE,x=(I,B)=>B===vt||B===st||!I.equals(b)?I.multiplyUnsafe(B):I.multiply(B),A=x(this,d).add(x(h,w));return A.is0()?void 0:A}toAffine(h){let{px:d,py:w,pz:b}=this,x=this.is0();h==null&&(h=x?n.ONE:n.inv(b));let A=n.mul(d,h),I=n.mul(w,h),B=n.mul(b,h);if(x)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:A,y:I}}isTorsionFree(){let{h,isTorsionFree:d}=e;if(h===st)return!0;if(d)return d(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:d}=e;return h===st?this:d?d(u,this):this.multiplyUnsafe(e.h)}toRawBytes(h=!0){return this.assertValidity(),r(u,this,h)}toHex(h=!0){return Kt(this.toRawBytes(h))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);let p=e.nBitLength,y=zr(u,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:i}}function Xi(t){let e=Sn(t);return Nt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Wr(t){let e=Xi(t),{Fp:n,n:r}=e,o=n.BYTES+1,s=2*n.BYTES+1;function i(m){return vt<m&&m<n.ORDER}function a(m){return K(m,r)}function c(m){return Re(m,r)}let{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:p}=Ji({...e,toBytes(m,E,L){let R=E.toAffine(),v=n.toBytes(R.x),N=Et;return L?N(Uint8Array.from([E.hasEvenY()?2:3]),v):N(Uint8Array.from([4]),v,n.toBytes(R.y))},fromBytes(m){let E=m.length,L=m[0],R=m.subarray(1);if(E===o&&(L===2||L===3)){let v=J(R);if(!i(v))throw new Error("Point is not on curve");let N=u(v),q=n.sqrt(N),M=(q&st)===st;return(L&1)===1!==M&&(q=n.neg(q)),{x:v,y:q}}else if(E===s&&L===4){let v=n.fromBytes(R.subarray(0,n.BYTES)),N=n.fromBytes(R.subarray(n.BYTES,2*n.BYTES));return{x:v,y:N}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),y=m=>Kt(ut(m,e.nByteLength));function g(m){let E=r>>st;return m>E}function h(m){return g(m)?a(-m):m}let d=(m,E,L)=>J(m.slice(E,L));class w{constructor(E,L,R){this.r=E,this.s=L,this.recovery=R,this.assertValidity()}static fromCompact(E){let L=e.nByteLength;return E=W("compactSignature",E,L*2),new w(d(E,0,L),d(E,L,2*L))}static fromDER(E){let{r:L,s:R}=Jt.toSig(W("DER",E));return new w(L,R)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new w(this.r,this.s,E)}recoverPublicKey(E){let{r:L,s:R,recovery:v}=this,N=S(W("msgHash",E));if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");let q=v===2||v===3?L+e.n:L;if(q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let M=(v&1)===0?"02":"03",G=l.fromHex(M+y(q)),Y=c(q),et=a(-N*Y),ot=a(R*Y),F=l.BASE.multiplyAndAddUnsafe(G,et,ot);if(!F)throw new Error("point at infinify");return F.assertValidity(),F}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Zt(this.toDERHex())}toDERHex(){return Jt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Zt(this.toCompactHex())}toCompactHex(){return y(this.r)+y(this.s)}}let b={isValidPrivateKey(m){try{return f(m),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{let m=An(e.n);return jr(e.randomBytes(m),e.n)},precompute(m=8,E=l.BASE){return E._setWindowSize(m),E.multiply(BigInt(3)),E}};function x(m,E=!0){return l.fromPrivateKey(m).toRawBytes(E)}function A(m){let E=m instanceof Uint8Array,L=typeof m=="string",R=(E||L)&&m.length;return E?R===o||R===s:L?R===2*o||R===2*s:m instanceof l}function I(m,E,L=!0){if(A(m))throw new Error("first arg must be private key");if(!A(E))throw new Error("second arg must be public key");return l.fromHex(E).multiply(f(m)).toRawBytes(L)}let B=e.bits2int||function(m){let E=J(m),L=m.length*8-e.nBitLength;return L>0?E>>BigInt(L):E},S=e.bits2int_modN||function(m){return a(B(m))},T=ge(e.nBitLength);function O(m){if(typeof m!="bigint")throw new Error("bigint expected");if(!(vt<=m&&m<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return ut(m,e.nByteLength)}function U(m,E,L=k){if(["recovered","canonical"].some(tt=>tt in L))throw new Error("sign() legacy options not supported");let{hash:R,randomBytes:v}=e,{lowS:N,prehash:q,extraEntropy:M}=L;N==null&&(N=!0),m=W("msgHash",m),q&&(m=W("prehashed msgHash",R(m)));let G=S(m),Y=f(E),et=[O(Y),O(G)];if(M!=null){let tt=M===!0?v(n.BYTES):M;et.push(W("extraEntropy",tt))}let ot=Et(...et),F=G;function gt(tt){let ee=B(tt);if(!p(ee))return;let Sr=c(ee),yt=l.BASE.multiply(ee).toAffine(),ne=a(yt.x);if(ne===vt)return;let ve=a(Sr*a(F+ne*Y));if(ve===vt)return;let _r=(yt.x===ne?0:2)|Number(yt.y&st),Tr=ve;return N&&g(ve)&&(Tr=h(ve),_r^=1),new w(ne,Tr,_r)}return{seed:ot,k2sig:gt}}let k={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function $(m,E,L=k){let{seed:R,k2sig:v}=U(m,E,L),N=e;return bn(N.hash.outputLen,N.nByteLength,N.hmac)(R,v)}l.BASE._setWindowSize(8);function V(m,E,L,R=P){let v=m;if(E=W("msgHash",E),L=W("publicKey",L),"strict"in R)throw new Error("options.strict was renamed to lowS");let{lowS:N,prehash:q}=R,M,G;try{if(typeof v=="string"||v instanceof Uint8Array)try{M=w.fromDER(v)}catch(yt){if(!(yt instanceof Jt.Err))throw yt;M=w.fromCompact(v)}else if(typeof v=="object"&&typeof v.r=="bigint"&&typeof v.s=="bigint"){let{r:yt,s:ne}=v;M=new w(yt,ne)}else throw new Error("PARSE");G=l.fromHex(L)}catch(yt){if(yt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&M.hasHighS())return!1;q&&(E=e.hash(E));let{r:Y,s:et}=M,ot=S(E),F=c(et),gt=a(ot*F),tt=a(Y*F),ee=l.BASE.multiplyAndAddUnsafe(G,gt,tt)?.toAffine();return ee?a(ee.x)===Y:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:I,sign:$,verify:V,ProjectivePoint:l,Signature:w,utils:b}}var Oe=class extends oe{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,kr(e);let r=pe(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return re(this),this.iHash.update(e),this}digestInto(e){re(this),pn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},_n=(t,e,n)=>new Oe(t,e).update(n).digest();_n.create=(t,e)=>new Oe(t,e);function Yi(t){return{hash:t,hmac:(e,...n)=>_n(t,e,Or(...n)),randomBytes:Se}}function Kr(t,e){let n=r=>Wr({...t,...Yi(r)});return Object.freeze({...n(e),create:n})}var Pe=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ne=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Jr=BigInt(1),Ce=BigInt(2),Zr=(t,e)=>(t+e/Ce)/e;function Xr(t){let e=Pe,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,f=l*l*t%e,u=nt(f,n,e)*f%e,p=nt(u,n,e)*f%e,y=nt(p,Ce,e)*l%e,g=nt(y,o,e)*y%e,h=nt(g,s,e)*g%e,d=nt(h,a,e)*h%e,w=nt(d,c,e)*d%e,b=nt(w,a,e)*h%e,x=nt(b,n,e)*f%e,A=nt(x,i,e)*g%e,I=nt(A,r,e)*l%e,B=nt(I,Ce,e);if(!Ln.eql(Ln.sqr(B),t))throw new Error("Cannot find square root");return B}var Ln=qr(Pe,void 0,void 0,{sqrt:Xr}),Ct=Kr({a:BigInt(0),b:BigInt(7),Fp:Ln,n:Ne,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=Ne,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Jr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),a=Zr(s*t,e),c=Zr(-r*t,e),l=K(t-a*n-c*o,e),f=K(-a*r-c*s,e),u=l>i,p=f>i;if(u&&(l=e-l),p&&(f=e-f),l>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:l,k2neg:p,k2:f}}}},Te),$e=BigInt(0),Yr=t=>typeof t=="bigint"&&$e<t&&t<Pe,Fi=t=>typeof t=="bigint"&&$e<t&&t<Ne,Gr={};function He(t,...e){let n=Gr[t];if(n===void 0){let r=Te(Uint8Array.from(t,o=>o.charCodeAt(0)));n=Et(r,r),Gr[t]=n}return Te(Et(n,...e))}var Un=t=>t.toRawBytes(!0).slice(1),In=t=>ut(t,32),Tn=t=>K(t,Pe),ye=t=>K(t,Ne),Rn=Ct.ProjectivePoint,Qi=(t,e,n)=>Rn.BASE.multiplyAndAddUnsafe(t,e,n);function kn(t){let e=Ct.utils.normPrivateKeyToScalar(t),n=Rn.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:ye(-e),bytes:Un(n)}}function Fr(t){if(!Yr(t))throw new Error("bad x: need 0 < x < p");let e=Tn(t*t),n=Tn(e*t+BigInt(7)),r=Xr(n);r%Ce!==$e&&(r=Tn(-r));let o=new Rn(t,r,Jr);return o.assertValidity(),o}function Qr(...t){return ye(J(He("BIP0340/challenge",...t)))}function ta(t){return kn(t).bytes}function ea(t,e,n=Se(32)){let r=W("message",t),{bytes:o,scalar:s}=kn(e),i=W("auxRand",n,32),a=In(s^J(He("BIP0340/aux",i))),c=He("BIP0340/nonce",a,o,r),l=ye(J(c));if(l===$e)throw new Error("sign failed: k is zero");let{bytes:f,scalar:u}=kn(l),p=Qr(f,o,r),y=new Uint8Array(64);if(y.set(f,0),y.set(In(ye(u+p*s)),32),!to(y,r,o))throw new Error("sign: Invalid signature produced");return y}function to(t,e,n){let r=W("signature",t,64),o=W("message",e),s=W("publicKey",n,32);try{let i=Fr(J(s)),a=J(r.subarray(0,32));if(!Yr(a))return!1;let c=J(r.subarray(32,64));if(!Fi(c))return!1;let l=Qr(In(a),Un(i),o),f=Qi(i,c,ye(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==a)}catch{return!1}}var se={getPublicKey:ta,sign:ea,verify:to,utils:{randomPrivateKey:Ct.utils.randomPrivateKey,lift_x:Fr,pointToBytes:Un,numberToBytesBE:ut,bytesToNumberBE:J,taggedHash:He,mod:K}};var Me=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var On=t=>t instanceof Uint8Array;var qe=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ht=(t,e)=>t<<32-e|t>>>e,na=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!na)throw new Error("Non little-endian hardware is not supported");var ra=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function D(t){if(!On(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=ra[t[n]];return e}function At(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function oa(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ht(t){if(typeof t=="string"&&(t=oa(t)),!On(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function ae(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!On(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var ie=class{clone(){return this._cloneInto()}};function Nn(t){let e=r=>t().update(Ht(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Ve(t=32){if(Me&&typeof Me.getRandomValues=="function")return Me.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Cn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function sa(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function eo(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function ia(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Cn(t.outputLen),Cn(t.blockLen)}function aa(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ca(t,e){eo(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var la={number:Cn,bool:sa,bytes:eo,hash:ia,exists:aa,output:ca},rt=la;function fa(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}var je=class extends ie{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=qe(this.buffer)}update(e){rt.exists(this);let{view:n,buffer:r,blockLen:o}=this;e=Ht(e);let s=e.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=qe(e);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rt.exists(this),rt.output(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;fa(r,o-8,BigInt(this.length*8),s),this.process(r,0);let a=qe(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return e.length=o,e.pos=a,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var ua=(t,e,n)=>t&e^~t&n,ha=(t,e,n)=>t&e^t&n^e&n,da=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),$t=new Uint32Array(64),ze=class extends je{constructor(){super(64,32,8,!1),this.A=Pt[0]|0,this.B=Pt[1]|0,this.C=Pt[2]|0,this.D=Pt[3]|0,this.E=Pt[4]|0,this.F=Pt[5]|0,this.G=Pt[6]|0,this.H=Pt[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[e,n,r,o,s,i,a,c]}set(e,n,r,o,s,i,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(e,n){for(let u=0;u<16;u++,n+=4)$t[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let p=$t[u-15],y=$t[u-2],g=ht(p,7)^ht(p,18)^p>>>3,h=ht(y,17)^ht(y,19)^y>>>10;$t[u]=h+$t[u-7]+g+$t[u-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){let p=ht(a,6)^ht(a,11)^ht(a,25),y=f+p+ua(a,c,l)+da[u]+$t[u]|0,h=(ht(r,2)^ht(r,13)^ht(r,22))+ha(r,o,s)|0;f=l,l=c,c=a,a=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,l,f)}roundClean(){$t.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Hn=class extends ze{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},it=Nn(()=>new ze),Ru=Nn(()=>new Hn);function ce(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Bt(...t){let e=(o,s)=>i=>o(s(i)),n=Array.from(t).reverse().reduce((o,s)=>o?e(o,s.encode):s.encode,void 0),r=t.reduce((o,s)=>o?e(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function St(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(ce(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function _t(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function We(t,e="="){if(ce(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function ao(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function no(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0,o=[],s=Array.from(t);for(s.forEach(i=>{if(ce(i),i<0||i>=e)throw new Error(`Wrong integer: ${i}`)});;){let i=0,a=!0;for(let c=r;c<s.length;c++){let l=s[c],f=e*i+l;if(!Number.isSafeInteger(f)||e*i/e!==i||f-l!==e*i)throw new Error("convertRadix: carry overflow");if(i=f%n,s[c]=Math.floor(f/n),!Number.isSafeInteger(s[c])||s[c]*n+i!==f)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(o.push(i),a)break}for(let i=0;i<t.length-1&&t[i]===0;i++)o.push(0);return o.reverse()}var co=(t,e)=>e?co(e,t%e):t,De=(t,e)=>t+(e-co(t,e));function Pn(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(De(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${De(e,n)}`);let o=0,s=0,i=2**n-1,a=[];for(let c of t){if(ce(c),c>=2**e)throw new Error(`convertRadix2: invalid data word=${c} from=${e}`);if(o=o<<e|c,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&a.push(o>>>0),a}function pa(t){return ce(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return no(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(no(e,t,2**8))}}}function Mt(t,e=!1){if(ce(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(De(8,t)>32||De(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Pn(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Pn(n,t,8,e))}}}function ro(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}var ga=Bt(Mt(4),St("0123456789ABCDEF"),_t("")),ya=Bt(Mt(5),St("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),We(5),_t("")),Nu=Bt(Mt(5),St("0123456789ABCDEFGHIJKLMNOPQRSTUV"),We(5),_t("")),Cu=Bt(Mt(5),St("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),_t(""),ao(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),at=Bt(Mt(6),St("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),We(6),_t("")),wa=Bt(Mt(6),St("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),We(6),_t("")),qn=t=>Bt(pa(58),St(t),_t("")),$n=qn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Hu=qn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Pu=qn("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),oo=[0,2,3,5,6,7,9,10,11],ba={encode(t){let e="";for(let n=0;n<t.length;n+=8){let r=t.subarray(n,n+8);e+=$n.encode(r).padStart(oo[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){let r=t.slice(n,n+11),o=oo.indexOf(r.length),s=$n.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(e)}};var Mn=Bt(St("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),_t("")),so=[996825010,642813549,513874426,1027748829,705979059];function we(t){let e=t>>25,n=(t&33554431)<<5;for(let r=0;r<so.length;r++)(e>>r&1)===1&&(n^=so[r]);return n}function io(t,e,n=1){let r=t.length,o=1;for(let s=0;s<r;s++){let i=t.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${t})`);o=we(o)^i>>5}o=we(o);for(let s=0;s<r;s++)o=we(o)^t.charCodeAt(s)&31;for(let s of e)o=we(o)^s;for(let s=0;s<6;s++)o=we(o);return o^=n,Mn.encode(Pn([o%2**30],30,5,!1))}function lo(t){let e=t==="bech32"?1:734539939,n=Mt(5),r=n.decode,o=n.encode,s=ro(r);function i(f,u,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);let y=f.length+7+u.length;if(p!==!1&&y>p)throw new TypeError(`Length ${y} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${Mn.encode(u)}${io(f,u,e)}`}function a(f,u=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||u!==!1&&f.length>u)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${u})`);let p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;let y=f.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');let g=f.slice(0,y),h=f.slice(y+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");let d=Mn.decode(h).slice(0,-6),w=io(g,d,e);if(!h.endsWith(w))throw new Error(`Invalid checksum in ${f}: expected "${w}"`);return{prefix:g,words:d}}let c=ro(a);function l(f){let{prefix:u,words:p}=a(f,!1);return{prefix:u,words:p,bytes:r(p)}}return{encode:i,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:o}}var qt=lo("bech32"),$u=lo("bech32m"),ma={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},xa=Bt(Mt(4),St("0123456789abcdef"),_t(""),ao(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),Ea={utf8:ma,hex:xa,base16:ga,base32:ya,base64:at,base64url:wa,base58:$n,base58xmr:ba},Mu=`Invalid encoding type. Available types: ${Object.keys(Ea).join(", ")}`;function Ke(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Vn(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function jn(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function C(t,...e){if(!jn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Vt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function be(t,e){C(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ze=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength);var H=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),jt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),va=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!va)throw new Error("Non little-endian hardware is not supported");var Aa=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Xt(t){C(t);let e="";for(let n=0;n<t.length;n++)e+=Aa[t[n]];return e}var Tt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function fo(t){if(t>=Tt._0&&t<=Tt._9)return t-Tt._0;if(t>=Tt._A&&t<=Tt._F)return t-(Tt._A-10);if(t>=Tt._a&&t<=Tt._f)return t-(Tt._a-10)}function zn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let i=fo(t.charCodeAt(s)),a=fo(t.charCodeAt(s+1));if(i===void 0||a===void 0){let c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[o]=i*16+a}return r}function Ba(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function wt(t){if(typeof t=="string")t=Ba(t);else if(jn(t))t=t.slice();else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function uo(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Yt(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var bt=(t,e)=>(Object.assign(e,t),e);function Ft(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}var Lt=16,Wn=new Uint8Array(16),mt=H(Wn),Sa=225,_a=(t,e,n,r)=>{let o=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^Sa<<24&-(o&1)}},ct=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function Ta(t){t.reverse();let e=t[15]&1,n=0;for(let r=0;r<t.length;r++){let o=t[r];t[r]=o>>>1|n,n=(o&1)<<7}return t[0]^=-e&225,t}var La=t=>t>64*1024?8:t>1024?4:2,Ge=class{constructor(e,n){this.blockLen=Lt,this.outputLen=Lt,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=wt(e),C(e,16);let r=jt(e),o=r.getUint32(0,!1),s=r.getUint32(4,!1),i=r.getUint32(8,!1),a=r.getUint32(12,!1),c=[];for(let g=0;g<128;g++)c.push({s0:ct(o),s1:ct(s),s2:ct(i),s3:ct(a)}),{s0:o,s1:s,s2:i,s3:a}=_a(o,s,i,a);let l=La(n||1024);if(![1,2,4,8].includes(l))throw new Error(`ghash: wrong window size=${l}, should be 2, 4 or 8`);this.W=l;let u=128/l,p=this.windowSize=2**l,y=[];for(let g=0;g<u;g++)for(let h=0;h<p;h++){let d=0,w=0,b=0,x=0;for(let A=0;A<l;A++){if(!(h>>>l-A-1&1))continue;let{s0:B,s1:S,s2:T,s3:O}=c[l*g+A];d^=B,w^=S,b^=T,x^=O}y.push({s0:d,s1:w,s2:b,s3:x})}this.t=y}_updateBlock(e,n,r,o){e^=this.s0,n^=this.s1,r^=this.s2,o^=this.s3;let{W:s,t:i,windowSize:a}=this,c=0,l=0,f=0,u=0,p=(1<<s)-1,y=0;for(let g of[e,n,r,o])for(let h=0;h<4;h++){let d=g>>>8*h&255;for(let w=8/s-1;w>=0;w--){let b=d>>>s*w&p,{s0:x,s1:A,s2:I,s3:B}=i[y*a+b];c^=x,l^=A,f^=I,u^=B,y+=1}}this.s0=c,this.s1=l,this.s2=f,this.s3=u}update(e){e=wt(e),Vt(this);let n=H(e),r=Math.floor(e.length/Lt),o=e.length%Lt;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return o&&(Wn.set(e.subarray(r*Lt)),this._updateBlock(mt[0],mt[1],mt[2],mt[3]),mt.fill(0)),this}destroy(){let{t:e}=this;for(let n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){Vt(this),be(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e}digest(){let e=new Uint8Array(Lt);return this.digestInto(e),this.destroy(),e}},Dn=class extends Ge{constructor(e,n){e=wt(e);let r=Ta(e.slice());super(r,n),r.fill(0)}update(e){e=wt(e),Vt(this);let n=H(e),r=e.length%Lt,o=Math.floor(e.length/Lt);for(let s=0;s<o;s++)this._updateBlock(ct(n[s*4+3]),ct(n[s*4+2]),ct(n[s*4+1]),ct(n[s*4+0]));return r&&(Wn.set(e.subarray(o*Lt)),this._updateBlock(ct(mt[3]),ct(mt[2]),ct(mt[1]),ct(mt[0])),mt.fill(0)),this}digestInto(e){Vt(this),be(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e.reverse()}};function ho(t){let e=(r,o)=>t(o,r.length).update(wt(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,o)=>t(r,o),e}var Kn=ho((t,e)=>new Ge(t,e)),po=ho((t,e)=>new Dn(t,e));var Q=16,Jn=4,Je=new Uint8Array(Q),Ia=283;function Xn(t){return t<<1^Ia&-(t>>7)}function le(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=Xn(t);return n}var Gn=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Xn(r))t[n]=r;let e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),ka=Gn.map((t,e)=>Gn.indexOf(e)),Ua=t=>t<<24|t>>>8,Zn=t=>t<<8|t>>>24;function go(t,e){if(t.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((l,f)=>e(t[f])),r=n.map(Zn),o=r.map(Zn),s=o.map(Zn),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){let u=l*256+f;i[u]=n[l]^r[f],a[u]=o[l]^s[f],c[u]=t[l]<<8|t[f]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:o,T3:s,T01:i,T23:a}}var Yn=go(Gn,t=>le(t,3)<<24|t<<16|t<<8|le(t,2)),yo=go(ka,t=>le(t,11)<<24|le(t,13)<<16|le(t,9)<<8|le(t,14)),Ra=(()=>{let t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=Xn(n))t[e]=n;return t})();function Dt(t){C(t);let e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);let{sbox2:n}=Yn,r=H(t),o=r.length,s=a=>xt(n,a,a,a,a),i=new Uint32Array(e+28);i.set(r);for(let a=o;a<i.length;a++){let c=i[a-1];a%o===0?c=s(Ua(c))^Ra[a/o-1]:o>6&&a%o===4&&(c=s(c)),i[a]=i[a-o]^c}return i}function wo(t){let e=Dt(t),n=e.slice(),r=e.length,{sbox2:o}=Yn,{T0:s,T1:i,T2:a,T3:c}=yo;for(let l=0;l<r;l+=4)for(let f=0;f<4;f++)n[l+f]=e[r-l-4+f];e.fill(0);for(let l=4;l<r-4;l++){let f=n[l],u=xt(o,f,f,f,f);n[l]=s[u&255]^i[u>>>8&255]^a[u>>>16&255]^c[u>>>24]}return n}function zt(t,e,n,r,o,s){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|s>>>24&255]}function xt(t,e,n,r,o){return t[e&255|n&65280]|t[r>>>16&255|o>>>16&65280]<<16}function lt(t,e,n,r,o){let{sbox2:s,T01:i,T23:a}=Yn,c=0;e^=t[c++],n^=t[c++],r^=t[c++],o^=t[c++];let l=t.length/4-2;for(let g=0;g<l;g++){let h=t[c++]^zt(i,a,e,n,r,o),d=t[c++]^zt(i,a,n,r,o,e),w=t[c++]^zt(i,a,r,o,e,n),b=t[c++]^zt(i,a,o,e,n,r);e=h,n=d,r=w,o=b}let f=t[c++]^xt(s,e,n,r,o),u=t[c++]^xt(s,n,r,o,e),p=t[c++]^xt(s,r,o,e,n),y=t[c++]^xt(s,o,e,n,r);return{s0:f,s1:u,s2:p,s3:y}}function bo(t,e,n,r,o){let{sbox2:s,T01:i,T23:a}=yo,c=0;e^=t[c++],n^=t[c++],r^=t[c++],o^=t[c++];let l=t.length/4-2;for(let g=0;g<l;g++){let h=t[c++]^zt(i,a,e,o,r,n),d=t[c++]^zt(i,a,n,e,o,r),w=t[c++]^zt(i,a,r,n,e,o),b=t[c++]^zt(i,a,o,r,n,e);e=h,n=d,r=w,o=b}let f=t[c++]^xt(s,e,o,r,n),u=t[c++]^xt(s,n,e,o,r),p=t[c++]^xt(s,r,n,e,o),y=t[c++]^xt(s,o,r,n,e);return{s0:f,s1:u,s2:p,s3:y}}function fe(t,e){if(!e)return new Uint8Array(t);if(C(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function Oa(t,e,n,r){C(e,Q),C(n);let o=n.length;r=fe(o,r);let s=e,i=H(s),{s0:a,s1:c,s2:l,s3:f}=lt(t,i[0],i[1],i[2],i[3]),u=H(n),p=H(r);for(let g=0;g+4<=u.length;g+=4){p[g+0]=u[g+0]^a,p[g+1]=u[g+1]^c,p[g+2]=u[g+2]^l,p[g+3]=u[g+3]^f;let h=1;for(let d=s.length-1;d>=0;d--)h=h+(s[d]&255)|0,s[d]=h&255,h>>>=8;({s0:a,s1:c,s2:l,s3:f}=lt(t,i[0],i[1],i[2],i[3]))}let y=Q*Math.floor(u.length/Jn);if(y<o){let g=new Uint32Array([a,c,l,f]),h=Ze(g);for(let d=y,w=0;d<o;d++,w++)r[d]=n[d]^h[w]}return r}function me(t,e,n,r,o){C(n,Q),C(r),o=fe(r.length,o);let s=n,i=H(s),a=jt(s),c=H(r),l=H(o),f=e?0:12,u=r.length,p=a.getUint32(f,e),{s0:y,s1:g,s2:h,s3:d}=lt(t,i[0],i[1],i[2],i[3]);for(let b=0;b+4<=c.length;b+=4)l[b+0]=c[b+0]^y,l[b+1]=c[b+1]^g,l[b+2]=c[b+2]^h,l[b+3]=c[b+3]^d,p=p+1>>>0,a.setUint32(f,p,e),{s0:y,s1:g,s2:h,s3:d}=lt(t,i[0],i[1],i[2],i[3]);let w=Q*Math.floor(c.length/Jn);if(w<u){let b=new Uint32Array([y,g,h,d]),x=Ze(b);for(let A=w,I=0;A<u;A++,I++)o[A]=r[A]^x[I]}return o}var Xu=bt({blockSize:16,nonceLength:16},function(e,n){C(e),C(n,Q);function r(o,s){let i=Dt(e),a=n.slice(),c=Oa(i,a,o,s);return i.fill(0),a.fill(0),c}return{encrypt:(o,s)=>r(o,s),decrypt:(o,s)=>r(o,s)}});function mo(t){if(C(t),t.length%Q!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Q}`)}function xo(t,e,n){let r=t.length,o=r%Q;if(!e&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let s=H(t);if(e){let c=Q-o;c||(c=Q),r=r+c}let i=fe(r,n),a=H(i);return{b:s,o:a,out:i}}function Eo(t,e){if(!e)return t;let n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);let o=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function vo(t){let e=new Uint8Array(16),n=H(e);e.set(t);let r=Q-t.length;for(let o=Q-r;o<Q;o++)e[o]=r;return n}var Yu=bt({blockSize:16},function(e,n={}){C(e);let r=!n.disablePadding;return{encrypt:(o,s)=>{C(o);let{b:i,o:a,out:c}=xo(o,r,s),l=Dt(e),f=0;for(;f+4<=i.length;){let{s0:u,s1:p,s2:y,s3:g}=lt(l,i[f+0],i[f+1],i[f+2],i[f+3]);a[f++]=u,a[f++]=p,a[f++]=y,a[f++]=g}if(r){let u=vo(o.subarray(f*4)),{s0:p,s1:y,s2:g,s3:h}=lt(l,u[0],u[1],u[2],u[3]);a[f++]=p,a[f++]=y,a[f++]=g,a[f++]=h}return l.fill(0),c},decrypt:(o,s)=>{mo(o);let i=wo(e),a=fe(o.length,s),c=H(o),l=H(a);for(let f=0;f+4<=c.length;){let{s0:u,s1:p,s2:y,s3:g}=bo(i,c[f+0],c[f+1],c[f+2],c[f+3]);l[f++]=u,l[f++]=p,l[f++]=y,l[f++]=g}return i.fill(0),Eo(a,r)}}}),Fn=bt({blockSize:16,nonceLength:16},function(e,n,r={}){C(e),C(n,16);let o=!r.disablePadding;return{encrypt:(s,i)=>{let a=Dt(e),{b:c,o:l,out:f}=xo(s,o,i),u=H(n),p=u[0],y=u[1],g=u[2],h=u[3],d=0;for(;d+4<=c.length;)p^=c[d+0],y^=c[d+1],g^=c[d+2],h^=c[d+3],{s0:p,s1:y,s2:g,s3:h}=lt(a,p,y,g,h),l[d++]=p,l[d++]=y,l[d++]=g,l[d++]=h;if(o){let w=vo(s.subarray(d*4));p^=w[0],y^=w[1],g^=w[2],h^=w[3],{s0:p,s1:y,s2:g,s3:h}=lt(a,p,y,g,h),l[d++]=p,l[d++]=y,l[d++]=g,l[d++]=h}return a.fill(0),f},decrypt:(s,i)=>{mo(s);let a=wo(e),c=H(n),l=fe(s.length,i),f=H(s),u=H(l),p=c[0],y=c[1],g=c[2],h=c[3];for(let d=0;d+4<=f.length;){let w=p,b=y,x=g,A=h;p=f[d+0],y=f[d+1],g=f[d+2],h=f[d+3];let{s0:I,s1:B,s2:S,s3:T}=bo(a,p,y,g,h);u[d++]=I^w,u[d++]=B^b,u[d++]=S^x,u[d++]=T^A}return a.fill(0),Eo(l,o)}}}),Fu=bt({blockSize:16,nonceLength:16},function(e,n){C(e),C(n,16);function r(o,s,i){let a=Dt(e),c=o.length;i=fe(c,i);let l=H(o),f=H(i),u=s?f:l,p=H(n),y=p[0],g=p[1],h=p[2],d=p[3];for(let b=0;b+4<=l.length;){let{s0:x,s1:A,s2:I,s3:B}=lt(a,y,g,h,d);f[b+0]=l[b+0]^x,f[b+1]=l[b+1]^A,f[b+2]=l[b+2]^I,f[b+3]=l[b+3]^B,y=u[b++],g=u[b++],h=u[b++],d=u[b++]}let w=Q*Math.floor(l.length/Jn);if(w<c){({s0:y,s1:g,s2:h,s3:d}=lt(a,y,g,h,d));let b=Ze(new Uint32Array([y,g,h,d]));for(let x=w,A=0;x<c;x++,A++)i[x]=o[x]^b[A];b.fill(0)}return a.fill(0),i}return{encrypt:(o,s)=>r(o,!0,s),decrypt:(o,s)=>r(o,!1,s)}});function Ao(t,e,n,r,o){let s=t.create(n,r.length+(o?.length||0));o&&s.update(o),s.update(r);let i=new Uint8Array(16),a=jt(i);return o&&Ft(a,0,BigInt(o.length*8),e),Ft(a,8,BigInt(r.length*8),e),s.update(i),s.digest()}var Qu=bt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){if(C(n),n.length===0)throw new Error("aes/gcm: empty nonce");let o=16;function s(a,c,l){let f=Ao(Kn,!1,a,l,r);for(let u=0;u<c.length;u++)f[u]^=c[u];return f}function i(){let a=Dt(e),c=Je.slice(),l=Je.slice();if(me(a,!1,l,l,c),n.length===12)l.set(n);else{let u=Je.slice(),p=jt(u);Ft(p,8,BigInt(n.length*8),!1),Kn.create(c).update(n).update(u).digestInto(l)}let f=me(a,!1,l,Je);return{xk:a,authKey:c,counter:l,tagMask:f}}return{encrypt:a=>{C(a);let{xk:c,authKey:l,counter:f,tagMask:u}=i(),p=new Uint8Array(a.length+o);me(c,!1,f,a,p);let y=s(l,u,p.subarray(0,p.length-o));return p.set(y,a.length),c.fill(0),p},decrypt:a=>{if(C(a),a.length<o)throw new Error(`aes/gcm: ciphertext less than tagLen (${o})`);let{xk:c,authKey:l,counter:f,tagMask:u}=i(),p=a.subarray(0,-o),y=a.subarray(-o),g=s(l,u,p);if(!Yt(g,y))throw new Error("aes/gcm: invalid ghash tag");let h=me(c,!1,f,p);return l.fill(0),u.fill(0),c.fill(0),h}}}),Xe=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)},th=bt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){let s=Xe("AAD",0,68719476736),i=Xe("plaintext",0,2**36),a=Xe("nonce",12,12),c=Xe("ciphertext",16,2**36+16);C(n),a(n.length),r&&(C(r),s(r.length));function l(){let p=e.length;if(p!==16&&p!==24&&p!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${p} bytes`);let y=Dt(e),g=new Uint8Array(p),h=new Uint8Array(16),d=H(n),w=0,b=d[0],x=d[1],A=d[2],I=0;for(let B of[h,g].map(H)){let S=H(B);for(let T=0;T<S.length;T+=2){let{s0:O,s1:U}=lt(y,w,b,x,A);S[T+0]=O,S[T+1]=U,w=++I}}return y.fill(0),{authKey:h,encKey:Dt(g)}}function f(p,y,g){let h=Ao(po,!0,y,g,r);for(let I=0;I<12;I++)h[I]^=n[I];h[15]&=127;let d=H(h),w=d[0],b=d[1],x=d[2],A=d[3];return{s0:w,s1:b,s2:x,s3:A}=lt(p,w,b,x,A),d[0]=w,d[1]=b,d[2]=x,d[3]=A,h}function u(p,y,g){let h=y.slice();return h[15]|=128,me(p,!0,h,g)}return{encrypt:p=>{C(p),i(p.length);let{encKey:y,authKey:g}=l(),h=f(y,g,p),d=new Uint8Array(p.length+16);return d.set(h,p.length),d.set(u(y,h,p)),y.fill(0),g.fill(0),d},decrypt:p=>{C(p),c(p.length);let y=p.subarray(-16),{encKey:g,authKey:h}=l(),d=u(g,y,p.subarray(0,-16)),w=f(g,h,d);if(g.fill(0),h.fill(0),!Yt(y,w))throw new Error("invalid polyval tag");return d}}});var X=(t,e)=>t[e++]&255|(t[e++]&255)<<8,Qn=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=wt(e),C(e,32);let n=X(e,0),r=X(e,2),o=X(e,4),s=X(e,6),i=X(e,8),a=X(e,10),c=X(e,12),l=X(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=X(e,16+2*f)}process(e,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],l=i[2],f=i[3],u=i[4],p=i[5],y=i[6],g=i[7],h=i[8],d=i[9],w=X(e,n+0),b=X(e,n+2),x=X(e,n+4),A=X(e,n+6),I=X(e,n+8),B=X(e,n+10),S=X(e,n+12),T=X(e,n+14),O=s[0]+(w&8191),U=s[1]+((w>>>13|b<<3)&8191),k=s[2]+((b>>>10|x<<6)&8191),P=s[3]+((x>>>7|A<<9)&8191),$=s[4]+((A>>>4|I<<12)&8191),V=s[5]+(I>>>1&8191),m=s[6]+((I>>>14|B<<2)&8191),E=s[7]+((B>>>11|S<<5)&8191),L=s[8]+((S>>>8|T<<8)&8191),R=s[9]+(T>>>5|o),v=0,N=v+O*a+U*(5*d)+k*(5*h)+P*(5*g)+$*(5*y);v=N>>>13,N&=8191,N+=V*(5*p)+m*(5*u)+E*(5*f)+L*(5*l)+R*(5*c),v+=N>>>13,N&=8191;let q=v+O*c+U*a+k*(5*d)+P*(5*h)+$*(5*g);v=q>>>13,q&=8191,q+=V*(5*y)+m*(5*p)+E*(5*u)+L*(5*f)+R*(5*l),v+=q>>>13,q&=8191;let M=v+O*l+U*c+k*a+P*(5*d)+$*(5*h);v=M>>>13,M&=8191,M+=V*(5*g)+m*(5*y)+E*(5*p)+L*(5*u)+R*(5*f),v+=M>>>13,M&=8191;let G=v+O*f+U*l+k*c+P*a+$*(5*d);v=G>>>13,G&=8191,G+=V*(5*h)+m*(5*g)+E*(5*y)+L*(5*p)+R*(5*u),v+=G>>>13,G&=8191;let Y=v+O*u+U*f+k*l+P*c+$*a;v=Y>>>13,Y&=8191,Y+=V*(5*d)+m*(5*h)+E*(5*g)+L*(5*y)+R*(5*p),v+=Y>>>13,Y&=8191;let et=v+O*p+U*u+k*f+P*l+$*c;v=et>>>13,et&=8191,et+=V*a+m*(5*d)+E*(5*h)+L*(5*g)+R*(5*y),v+=et>>>13,et&=8191;let ot=v+O*y+U*p+k*u+P*f+$*l;v=ot>>>13,ot&=8191,ot+=V*c+m*a+E*(5*d)+L*(5*h)+R*(5*g),v+=ot>>>13,ot&=8191;let F=v+O*g+U*y+k*p+P*u+$*f;v=F>>>13,F&=8191,F+=V*l+m*c+E*a+L*(5*d)+R*(5*h),v+=F>>>13,F&=8191;let gt=v+O*h+U*g+k*y+P*p+$*u;v=gt>>>13,gt&=8191,gt+=V*f+m*l+E*c+L*a+R*(5*d),v+=gt>>>13,gt&=8191;let tt=v+O*d+U*h+k*g+P*y+$*p;v=tt>>>13,tt&=8191,tt+=V*u+m*f+E*l+L*c+R*a,v+=tt>>>13,tt&=8191,v=(v<<2)+v|0,v=v+N|0,N=v&8191,v=v>>>13,q+=v,s[0]=N,s[1]=q,s[2]=M,s[3]=G,s[4]=Y,s[5]=et,s[6]=ot,s[7]=F,s[8]=gt,s[9]=tt}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+o,o=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let i=e[0]+n[0];e[0]=i&65535;for(let a=1;a<8;a++)i=(e[a]+n[a]|0)+(i>>>16)|0,e[a]=i&65535}update(e){Vt(this);let{buffer:n,blockLen:r}=this;e=wt(e);let o=e.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Vt(this),be(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)e[s++]=r[i]>>>0,e[s++]=r[i]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function Na(t){let e=(r,o)=>t(o).update(wt(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var Bo=Na(t=>new Qn(t));var _o=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Ca=_o("expand 16-byte k"),Ha=_o("expand 32-byte k"),Pa=H(Ca),To=H(Ha),ah=To.slice();function _(t,e){return t<<e|t>>>32-e}function tr(t){return t.byteOffset%4===0}var Ye=64,$a=16,Lo=2**32-1,So=new Uint32Array;function Ma(t,e,n,r,o,s,i,a){let c=o.length,l=new Uint8Array(Ye),f=H(l),u=tr(o)&&tr(s),p=u?H(o):So,y=u?H(s):So;for(let g=0;g<c;i++){if(t(e,n,r,f,i,a),i>=Lo)throw new Error("arx: counter overflow");let h=Math.min(Ye,c-g);if(u&&h===Ye){let d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let w=0,b;w<$a;w++)b=d+w,y[b]=p[b]^f[w];g+=Ye;continue}for(let d=0,w;d<h;d++)w=g+d,s[w]=o[w]^l[d];g+=h}}function er(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=uo({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Ke(o),Ke(i),Vn(s),Vn(n),(a,c,l,f,u=0)=>{C(a),C(c),C(l);let p=l.length;if(f||(f=new Uint8Array(p)),C(f),Ke(u),u<0||u>=Lo)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);let y=[],g=a.length,h,d;if(g===32)h=a.slice(),y.push(h),d=To;else if(g===16&&n)h=new Uint8Array(32),h.set(a),h.set(a,16),d=Pa,y.push(h);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);tr(c)||(c=c.slice(),y.push(c));let w=H(h);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,w,H(c.subarray(0,16)),w),c=c.subarray(16)}let b=16-o;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){let A=new Uint8Array(12);A.set(c,s?0:12-c.length),c=A,y.push(c)}let x=H(c);for(Ma(t,d,w,x,l,f,u,i);y.length>0;)y.pop().fill(0);return f}}function Uo(t,e,n,r,o,s=20){let i=t[0],a=t[1],c=t[2],l=t[3],f=e[0],u=e[1],p=e[2],y=e[3],g=e[4],h=e[5],d=e[6],w=e[7],b=o,x=n[0],A=n[1],I=n[2],B=i,S=a,T=c,O=l,U=f,k=u,P=p,$=y,V=g,m=h,E=d,L=w,R=b,v=x,N=A,q=I;for(let G=0;G<s;G+=2)B=B+U|0,R=_(R^B,16),V=V+R|0,U=_(U^V,12),B=B+U|0,R=_(R^B,8),V=V+R|0,U=_(U^V,7),S=S+k|0,v=_(v^S,16),m=m+v|0,k=_(k^m,12),S=S+k|0,v=_(v^S,8),m=m+v|0,k=_(k^m,7),T=T+P|0,N=_(N^T,16),E=E+N|0,P=_(P^E,12),T=T+P|0,N=_(N^T,8),E=E+N|0,P=_(P^E,7),O=O+$|0,q=_(q^O,16),L=L+q|0,$=_($^L,12),O=O+$|0,q=_(q^O,8),L=L+q|0,$=_($^L,7),B=B+k|0,q=_(q^B,16),E=E+q|0,k=_(k^E,12),B=B+k|0,q=_(q^B,8),E=E+q|0,k=_(k^E,7),S=S+P|0,R=_(R^S,16),L=L+R|0,P=_(P^L,12),S=S+P|0,R=_(R^S,8),L=L+R|0,P=_(P^L,7),T=T+$|0,v=_(v^T,16),V=V+v|0,$=_($^V,12),T=T+$|0,v=_(v^T,8),V=V+v|0,$=_($^V,7),O=O+U|0,N=_(N^O,16),m=m+N|0,U=_(U^m,12),O=O+U|0,N=_(N^O,8),m=m+N|0,U=_(U^m,7);let M=0;r[M++]=i+B|0,r[M++]=a+S|0,r[M++]=c+T|0,r[M++]=l+O|0,r[M++]=f+U|0,r[M++]=u+k|0,r[M++]=p+P|0,r[M++]=y+$|0,r[M++]=g+V|0,r[M++]=h+m|0,r[M++]=d+E|0,r[M++]=w+L|0,r[M++]=b+R|0,r[M++]=x+v|0,r[M++]=A+N|0,r[M++]=I+q|0}function qa(t,e,n,r){let o=t[0],s=t[1],i=t[2],a=t[3],c=e[0],l=e[1],f=e[2],u=e[3],p=e[4],y=e[5],g=e[6],h=e[7],d=n[0],w=n[1],b=n[2],x=n[3];for(let I=0;I<20;I+=2)o=o+c|0,d=_(d^o,16),p=p+d|0,c=_(c^p,12),o=o+c|0,d=_(d^o,8),p=p+d|0,c=_(c^p,7),s=s+l|0,w=_(w^s,16),y=y+w|0,l=_(l^y,12),s=s+l|0,w=_(w^s,8),y=y+w|0,l=_(l^y,7),i=i+f|0,b=_(b^i,16),g=g+b|0,f=_(f^g,12),i=i+f|0,b=_(b^i,8),g=g+b|0,f=_(f^g,7),a=a+u|0,x=_(x^a,16),h=h+x|0,u=_(u^h,12),a=a+u|0,x=_(x^a,8),h=h+x|0,u=_(u^h,7),o=o+l|0,x=_(x^o,16),g=g+x|0,l=_(l^g,12),o=o+l|0,x=_(x^o,8),g=g+x|0,l=_(l^g,7),s=s+f|0,d=_(d^s,16),h=h+d|0,f=_(f^h,12),s=s+f|0,d=_(d^s,8),h=h+d|0,f=_(f^h,7),i=i+u|0,w=_(w^i,16),p=p+w|0,u=_(u^p,12),i=i+u|0,w=_(w^i,8),p=p+w|0,u=_(u^p,7),a=a+c|0,b=_(b^a,16),y=y+b|0,c=_(c^y,12),a=a+c|0,b=_(b^a,8),y=y+b|0,c=_(c^y,7);let A=0;r[A++]=o,r[A++]=s,r[A++]=i,r[A++]=a,r[A++]=d,r[A++]=w,r[A++]=b,r[A++]=x}var Fe=er(Uo,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Va=er(Uo,{counterRight:!1,counterLength:8,extendNonceFn:qa,allowShortKeys:!1});var ja=new Uint8Array(16),Io=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(ja.subarray(n))},za=new Uint8Array(32);function ko(t,e,n,r,o){let s=t(e,n,za),i=Bo.create(s);o&&Io(i,o),Io(i,r);let a=new Uint8Array(16),c=jt(a);Ft(c,0,BigInt(o?o.length:0),!0),Ft(c,8,BigInt(r.length),!0),i.update(a);let l=i.digest();return s.fill(0),l}var Ro=t=>(e,n,r)=>(C(e,32),C(n),{encrypt:(s,i)=>{let a=s.length,c=a+16;i?C(i,c):i=new Uint8Array(c),t(e,n,s,i,1);let l=ko(t,e,n,i.subarray(0,-16),r);return i.set(l,a),i},decrypt:(s,i)=>{let a=s.length,c=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");i?C(i,c):i=new Uint8Array(c);let l=s.subarray(0,-16),f=s.subarray(-16),u=ko(t,e,n,l,r);if(!Yt(f,u))throw new Error("invalid tag");return t(e,n,l,i,1),i}}),dh=bt({blockSize:64,nonceLength:12,tagLength:16},Ro(Fe)),ph=bt({blockSize:64,nonceLength:24,tagLength:16},Ro(Va));var Qe=class extends ie{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,rt.hash(e);let r=Ht(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return rt.exists(this),this.iHash.update(e),this}digestInto(e){rt.exists(this),rt.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ue=(t,e,n)=>new Qe(t,e).update(n).digest();ue.create=(t,e)=>new Qe(t,e);function No(t,e,n){return rt.hash(t),n===void 0&&(n=new Uint8Array(t.outputLen)),ue(t,Ht(n),Ht(e))}var nr=new Uint8Array([0]),Oo=new Uint8Array;function Co(t,e,n,r=32){if(rt.hash(t),rt.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(r/t.outputLen);n===void 0&&(n=Oo);let s=new Uint8Array(o*t.outputLen),i=ue.create(t,e),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let l=0;l<o;l++)nr[0]=l+1,a.update(l===0?Oo:c).update(n).update(nr).digestInto(c),s.set(c,t.outputLen*l),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),nr.fill(0),s.slice(0,r)}var Da=Object.defineProperty,j=(t,e)=>{for(var n in e)Da(t,n,{get:e[n],enumerable:!0})},Wt=Symbol("verified"),Wa=t=>t instanceof Object;function rn(t){if(!Wa(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}function Ka(t){return t.sort((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id))}var Mo={};j(Mo,{Queue:()=>Vo,QueueNode:()=>qo,binarySearch:()=>ir,bytesToHex:()=>D,hexToBytes:()=>At,insertEventIntoAscendingList:()=>Ga,insertEventIntoDescendingList:()=>Za,normalizeURL:()=>te,utf8Decoder:()=>Ut,utf8Encoder:()=>dt});var Ut=new TextDecoder("utf-8"),dt=new TextEncoder;function te(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.protocol==="http:"?e.protocol="ws:":e.protocol==="https:"&&(e.protocol="wss:"),e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function Za(t,e){let[n,r]=ir(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function Ga(t,e){let[n,r]=ir(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function ir(t,e){let n=0,r=t.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),s=e(t[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var qo=class{value;next=null;prev=null;constructor(t){this.value=t}},Vo=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){let e=new qo(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let e=this.first;return this.first=null,this.last=null,e.value}let t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},Ja=class{generateSecretKey(){return se.utils.randomPrivateKey()}getPublicKey(t){return D(se.getPublicKey(t))}finalizeEvent(t,e){let n=t;return n.pubkey=D(se.getPublicKey(e)),n.id=xe(n),n.sig=D(se.sign(xe(n),e)),n[Wt]=!0,n}verifyEvent(t){if(typeof t[Wt]=="boolean")return t[Wt];let e=xe(t);if(e!==t.id)return t[Wt]=!1,!1;try{let n=se.verify(t.sig,e,t.pubkey);return t[Wt]=n,n}catch{return t[Wt]=!1,!1}}};function jo(t){if(!rn(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function xe(t){let e=it(dt.encode(jo(t)));return D(e)}var on=new Ja,zo=on.generateSecretKey,sn=on.getPublicKey,pt=on.finalizeEvent,de=on.verifyEvent,Do={};j(Do,{Application:()=>al,BadgeAward:()=>rc,BadgeDefinition:()=>tl,BlockedRelaysList:()=>Hc,BlossomServerList:()=>zc,BookmarkList:()=>Oc,Bookmarksets:()=>Yc,Calendar:()=>pl,CalendarEventRSVP:()=>gl,ChannelCreation:()=>Xo,ChannelHideMessage:()=>Qo,ChannelMessage:()=>Fo,ChannelMetadata:()=>Yo,ChannelMuteUser:()=>ts,ChatMessage:()=>oc,ClassifiedListing:()=>fl,ClientAuth:()=>ns,Comment:()=>dc,CommunitiesList:()=>Nc,CommunityDefinition:()=>ml,CommunityPostApproval:()=>Ec,Contacts:()=>tc,CreateOrUpdateProduct:()=>rl,CreateOrUpdateStall:()=>nl,Curationsets:()=>Fc,Date:()=>hl,DirectMessageRelaysList:()=>Vc,DraftClassifiedListing:()=>ul,DraftLong:()=>sl,Emojisets:()=>il,EncryptedDirectMessage:()=>ec,EventDeletion:()=>nc,FavoriteRelays:()=>$c,FileMessage:()=>ic,FileMetadata:()=>hc,FileServerPreference:()=>jc,Followsets:()=>Gc,ForumThread:()=>sc,GenericRepost:()=>lr,Genericlists:()=>Jc,GiftWrap:()=>es,GroupMetadata:()=>xl,HTTPAuth:()=>fr,Handlerinformation:()=>bl,Handlerrecommendation:()=>wl,Highlights:()=>Lc,InterestsList:()=>Mc,Interestsets:()=>el,JobFeedback:()=>Bc,JobRequest:()=>vc,JobResult:()=>Ac,Label:()=>xc,LightningPubRPC:()=>Wc,LiveChatMessage:()=>pc,LiveEvent:()=>cl,LongFormArticle:()=>ol,Metadata:()=>Fa,Mutelist:()=>kc,NWCWalletInfo:()=>Dc,NWCWalletRequest:()=>rs,NWCWalletResponse:()=>Kc,NormalVideo:()=>cc,NostrConnect:()=>Zc,OpenTimestamps:()=>fc,Photo:()=>ac,Pinlist:()=>Uc,Poll:()=>uc,PollResponse:()=>Ic,PrivateDirectMessage:()=>Jo,ProblemTracker:()=>wc,ProfileBadges:()=>Qc,PublicChatsList:()=>Cc,Reaction:()=>cr,RecommendRelay:()=>Qa,RelayList:()=>Rc,RelayReview:()=>yl,Relaysets:()=>Xc,Report:()=>bc,Reporting:()=>mc,Repost:()=>ar,Seal:()=>Go,SearchRelaysList:()=>Pc,ShortTextNote:()=>Zo,ShortVideo:()=>lc,Time:()=>dl,UserEmojiList:()=>qc,UserStatuses:()=>ll,Voice:()=>gc,VoiceComment:()=>yc,Zap:()=>Tc,ZapGoal:()=>Sc,ZapRequest:()=>_c,classifyKind:()=>Xa,isAddressableKind:()=>cn,isEphemeralKind:()=>Ko,isKind:()=>Ya,isRegularKind:()=>Wo,isReplaceableKind:()=>an});function Wo(t){return t<1e4&&t!==0&&t!==3}function an(t){return t===0||t===3||1e4<=t&&t<2e4}function Ko(t){return 2e4<=t&&t<3e4}function cn(t){return 3e4<=t&&t<4e4}function Xa(t){return Wo(t)?"regular":an(t)?"replaceable":Ko(t)?"ephemeral":cn(t)?"parameterized":"unknown"}function Ya(t,e){let n=e instanceof Array?e:[e];return rn(t)&&n.includes(t.kind)||!1}var Fa=0,Zo=1,Qa=2,tc=3,ec=4,nc=5,ar=6,cr=7,rc=8,oc=9,sc=11,Go=13,Jo=14,ic=15,lr=16,ac=20,cc=21,lc=22,Xo=40,Yo=41,Fo=42,Qo=43,ts=44,fc=1040,es=1059,uc=1068,hc=1063,dc=1111,pc=1311,gc=1222,yc=1244,wc=1971,bc=1984,mc=1984,xc=1985,Ec=4550,vc=5999,Ac=6999,Bc=7e3,Sc=9041,_c=9734,Tc=9735,Lc=9802,Ic=1018,kc=1e4,Uc=10001,Rc=10002,Oc=10003,Nc=10004,Cc=10005,Hc=10006,Pc=10007,$c=10012,Mc=10015,qc=10030,Vc=10050,jc=10096,zc=10063,Dc=13194,Wc=21e3,ns=22242,rs=23194,Kc=23195,Zc=24133,fr=27235,Gc=3e4,Jc=30001,Xc=30002,Yc=30003,Fc=30004,Qc=30008,tl=30009,el=30015,nl=30017,rl=30018,ol=30023,sl=30024,il=30030,al=30078,cl=30311,ll=30315,fl=30402,ul=30403,hl=31922,dl=31923,pl=31924,gl=31925,yl=31987,wl=31989,bl=31990,ml=34550,xl=39e3;function os(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=n.slice(1),o=t[`#${r}`];if(o&&!e.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function ss(t,e){for(let n=0;n<t.length;n++)if(os(t[n],e))return!0;return!1}function El(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach(([o,s])=>{if(o==="kinds"||o==="ids"||o==="authors"||o[0]==="#"){e[o]=e[o]||[];for(let i=0;i<s.length;i++){let a=s[i];e[o].includes(a)||e[o].push(a)}}}),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function vl(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(let[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every(e=>an(e))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every(e=>cn(e))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var is={};j(is,{getHex64:()=>ln,getInt:()=>as,getSubscriptionId:()=>cs,matchEventId:()=>Al,matchEventKind:()=>Sl,matchEventPubkey:()=>Bl});function ln(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function as(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function cs(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return t.slice(r+1,s)}function Al(t,e){return e===ln(t,"id")}function Bl(t,e){return e===ln(t,"pubkey")}function Sl(t,e){return e===as(t,"kind")}var ls={};j(ls,{makeAuthEvent:()=>fs});function fs(t,e){return{kind:ns,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function _l(){return new Promise((t,e)=>{try{if(typeof MessageChannel<"u"){let n=new MessageChannel,r=()=>{n.port1.removeEventListener("message",r),t()};n.port1.addEventListener("message",r),n.port2.postMessage(0),n.port1.start()}else typeof setImmediate<"u"?setImmediate(t):typeof setTimeout<"u"?setTimeout(t,0):t()}catch(n){console.error("during yield: ",n),e(n)}})}var Tl=t=>(t[Wt]=!0,!0),us=class extends Error{constructor(t,e){super(`Tried to send message '${t} on a closed connection to ${e}.`),this.name="SendingOnClosedConnection"}},ur=class{url;_connected=!1;onclose=null;onnotice=t=>console.debug(`NOTICE from ${this.url}: ${t}`);onauth;baseEoseTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Vo;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=te(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket,this.enablePing=e.enablePing,this.enableReconnect=e.enableReconnect||!1}static async connect(t,e){let n=new ur(t,e);return await n.connect(e),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){let t=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},t)}handleHardClose(t){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;let e=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!e?this.reconnect():this.closeAllSubscriptions(t)}async connect(t){let e;return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((n,r)=>{t?.timeout&&(e=setTimeout(()=>{r("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},t.timeout)),t?.abort&&(t.abort.onabort=r);try{this.ws=new this._WebSocket(this.url)}catch(o){clearTimeout(e),r(o);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(e),this._connected=!0;let o=this.reconnectAttempts>0;this.reconnectAttempts=0;for(let s of this.openSubs.values()){if(s.eosed=!1,o)for(let i=0;i<s.filters.length;i++)s.lastEmitted&&(s.filters[i].since=s.lastEmitted+1);s.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),n()},this.ws.onerror=o=>{clearTimeout(e),r(o.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=o=>{clearTimeout(e),r(o.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(t=>{this.ws.once("pong",()=>t(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((t,e)=>{if(!this.connectionPromise)return e(new Error(`no connection to ${this.url}, can't ping`));try{let n=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{t(!0),n.close()},onclose(){t(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(n){e(n)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(e=>setTimeout(()=>e(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await _l();this.queueRunning=!1}handleNext(){let t=this.incomingMessageQueue.dequeue();if(!t)return!1;let e=cs(t);if(e){let n=this.openSubs.get(e);if(!n)return;let r=ln(t,"id"),o=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),o)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{let r=this.openSubs.get(n[1]),o=n[2];this.verifyEvent(o)&&ss(r.filters,o)&&r.onevent(o),(!r.lastEmitted||r.lastEmitted<o.created_at)&&(r.lastEmitted=o.created_at);return}case"COUNT":{let r=n[1],o=n[2],s=this.openCountRequests.get(r);s&&(s.resolve(o.count),this.openCountRequests.delete(r));return}case"EOSE":{let r=this.openSubs.get(n[1]);if(!r)return;r.receivedEose();return}case"OK":{let r=n[1],o=n[2],s=n[3],i=this.openEventPublishes.get(r);i&&(clearTimeout(i.timeout),o?i.resolve(s):i.reject(new Error(s)),this.openEventPublishes.delete(r));return}case"CLOSED":{let r=n[1],o=this.openSubs.get(r);if(!o)return;o.closed=!0,o.close(n[2]);return}case"NOTICE":{this.onnotice(n[1]);return}case"AUTH":{this.challenge=n[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(n[1])?.oncustom?.(n);return}}}catch{return}}async send(t){if(!this.connectionPromise)throw new us(t,this.url);this.connectionPromise.then(()=>{this.ws?.send(t)})}async auth(t){let e=this.challenge;if(!e)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,r)=>{try{let o=await t(fs(this.url,e)),s=setTimeout(()=>{let i=this.openEventPublishes.get(o.id);i&&(i.reject(new Error("auth timed out")),this.openEventPublishes.delete(o.id))},this.publishTimeout);this.openEventPublishes.set(o.id,{resolve:n,reject:r,timeout:s}),this.send('["AUTH",'+JSON.stringify(o)+"]")}catch(o){console.warn("subscribe auth function failed:",o)}}),this.authPromise)}async publish(t){let e=new Promise((n,r)=>{let o=setTimeout(()=>{let s=this.openEventPublishes.get(t.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))},this.publishTimeout);this.openEventPublishes.set(t.id,{resolve:n,reject:r,timeout:o})});return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;let n=e?.id||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){let n=this.prepareSubscription(t,e);return n.fire(),e.abort&&(e.abort.onabort=()=>n.close(String(e.abort.reason||"<aborted>"))),n}prepareSubscription(t,e){this.serial++;let n=e.id||(e.label?e.label+":":"sub:")+this.serial,r=new Ll(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Ll=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){if(n.length===0)throw new Error("subscription can't be created with zero filters");this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(e){if(!(e instanceof us))throw e}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(t)}},hs;try{hs=WebSocket}catch{}var ds=class extends ur{constructor(t,e){super(t,{verifyEvent:de,websocketImplementation:hs,...e})}static async connect(t,e){let n=new ds(t,e);return await n.connect(),n}},Il=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation,this.enablePing=t.enablePing,this.enableReconnect=t.enableReconnect||!1,this.automaticallyAuth=t.automaticallyAuth}async ensureRelay(t,e){t=te(t);let n=this.relays.get(t);if(n||(n=new ur(t,{verifyEvent:this.trustedRelayURLs.has(t)?Tl:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),n.onclose=()=>{n&&!n.enableReconnect&&this.relays.delete(t)},this.relays.set(t,n)),this.automaticallyAuth){let r=this.automaticallyAuth(t);r&&(n.onauth=r)}return await n.connect({timeout:e?.connectionTimeout,abort:e?.abort}),n}close(t){t.map(te).forEach(e=>{this.relays.get(e)?.close(),this.relays.delete(e)})}subscribe(t,e,n){let r=[];for(let o=0;o<t.length;o++){let s=te(t[o]);r.find(i=>i.url===s)||r.push({url:s,filter:e})}return this.subscribeMap(r,n)}subscribeMany(t,e,n){let r=[],o=[];for(let s=0;s<t.length;s++){let i=te(t[s]);o.indexOf(i)===-1&&(o.push(i),r.push({url:i,filter:e}))}return this.subscribeMap(r,n)}subscribeMap(t,e){let n=new Map;for(let p of t){let{url:y,filter:g}=p;n.has(y)||n.set(y,[]),n.get(y).push(g)}let r=Array.from(n.entries()).map(([p,y])=>({url:p,filters:y}));this.trackRelays&&(e.receivedEvent=(p,y)=>{let g=this.seenOn.get(y);g||(g=new Set,this.seenOn.set(y,g)),g.add(p)});let o=new Set,s=[],i=[],a=p=>{i[p]||(i[p]=!0,i.filter(y=>y).length===r.length&&(e.oneose?.(),a=()=>{}))},c=[],l=(p,y)=>{c[p]||(a(p),c[p]=y,c.filter(g=>g).length===r.length&&(e.onclose?.(c),l=()=>{}))},f=p=>{if(e.alreadyHaveEvent?.(p))return!0;let y=o.has(p);return o.add(p),y},u=Promise.all(r.map(async({url:p,filters:y},g)=>{let h;try{h=await this.ensureRelay(p,{connectionTimeout:e.maxWait?Math.max(e.maxWait*.8,e.maxWait-1e3):void 0,abort:e.abort})}catch(w){l(g,w?.message||String(w));return}let d=h.subscribe(y,{...e,oneose:()=>a(g),onclose:w=>{w.startsWith("auth-required: ")&&e.onauth?h.auth(e.onauth).then(()=>{h.subscribe(y,{...e,oneose:()=>a(g),onclose:b=>{l(g,b)},alreadyHaveEvent:f,eoseTimeout:e.maxWait,abort:e.abort})}).catch(b=>{l(g,`auth was required and attempted, but failed with: ${b}`)}):l(g,w)},alreadyHaveEvent:f,eoseTimeout:e.maxWait,abort:e.abort});s.push(d)}));return{async close(p){await u,s.forEach(y=>{y.close(p)})}}}subscribeEose(t,e,n){let r=this.subscribe(t,e,{...n,oneose(){r.close("closed automatically on eose")}});return r}subscribeManyEose(t,e,n){let r=this.subscribeMany(t,e,{...n,oneose(){r.close("closed automatically on eose")}});return r}async querySync(t,e,n){return new Promise(async r=>{let o=[];this.subscribeEose(t,e,{...n,onevent(s){o.push(s)},onclose(s){r(o)}})})}async get(t,e,n){e.limit=1;let r=await this.querySync(t,e,n);return r.sort((o,s)=>s.created_at-o.created_at),r[0]||null}publish(t,e,n){return t.map(te).map(async(r,o,s)=>{if(s.indexOf(r)!==o)return Promise.reject("duplicate url");let i=await this.ensureRelay(r);return i.publish(e).catch(async a=>{if(a instanceof Error&&a.message.startsWith("auth-required: ")&&n?.onauth)return await i.auth(n.onauth),i.publish(e);throw a}).then(a=>{if(this.trackRelays){let c=this.seenOn.get(e.id);c||(c=new Set,this.seenOn.set(e.id,c)),c.add(i)}return a})})}listConnectionStatus(){let t=new Map;return this.relays.forEach((e,n)=>t.set(n,e.connected)),t}destroy(){this.relays.forEach(t=>t.close()),this.relays=new Map}},ps;try{ps=WebSocket}catch{}var kl=class extends Il{constructor(t){super({verifyEvent:de,websocketImplementation:ps,...t})}},gs={};j(gs,{BECH32_REGEX:()=>ys,Bech32MaxSize:()=>hr,NostrTypeGuard:()=>Ul,decode:()=>Ee,decodeNostrURI:()=>Ol,encodeBytes:()=>un,naddrEncode:()=>Ml,neventEncode:()=>$l,noteEncode:()=>Hl,nprofileEncode:()=>Pl,npubEncode:()=>Cl,nsecEncode:()=>Nl});var Ul={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},hr=5e3,ys=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Rl(t){let e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function Ol(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),Ee(t)}catch{return{type:"invalid",data:null}}}function Ee(t){let{prefix:e,words:n}=qt.decode(t,hr),r=new Uint8Array(qt.fromWords(n));switch(e){case"nprofile":{let o=rr(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:D(o[0][0]),relays:o[1]?o[1].map(s=>Ut.decode(s)):[]}}}case"nevent":{let o=rr(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:D(o[0][0]),relays:o[1]?o[1].map(s=>Ut.decode(s)):[],author:o[2]?.[0]?D(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(D(o[3][0]),16):void 0}}}case"naddr":{let o=rr(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ut.decode(o[0][0]),pubkey:D(o[2][0]),kind:parseInt(D(o[3][0]),16),relays:o[1]?o[1].map(s=>Ut.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:D(r)};default:throw new Error(`unknown prefix ${e}`)}}function rr(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function Nl(t){return un("nsec",t)}function Cl(t){return un("npub",At(t))}function Hl(t){return un("note",At(t))}function fn(t,e){let n=qt.toWords(e);return qt.encode(t,n,hr)}function un(t,e){return fn(t,e)}function Pl(t){let e=dr({0:[At(t.pubkey)],1:(t.relays||[]).map(n=>dt.encode(n))});return fn("nprofile",e)}function $l(t){let e;t.kind!==void 0&&(e=Rl(t.kind));let n=dr({0:[At(t.id)],1:(t.relays||[]).map(r=>dt.encode(r)),2:t.author?[At(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return fn("nevent",n)}function Ml(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=dr({0:[dt.encode(t.identifier)],1:(t.relays||[]).map(r=>dt.encode(r)),2:[At(t.pubkey)],3:[new Uint8Array(e)]});return fn("naddr",n)}function dr(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),e.push(s)})}),ae(...e)}var ql=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function Vl(t){let e=[];for(let n of t.content.matchAll(ql))if(n[2])try{let{type:r,data:o}=Ee(n[1]);switch(r){case"npub":{e.push({text:n[0],profile:{pubkey:o,relays:[]}});break}case"nprofile":{e.push({text:n[0],profile:o});break}case"note":{e.push({text:n[0],event:{id:o,relays:[]}});break}case"nevent":{e.push({text:n[0],event:o});break}case"naddr":{e.push({text:n[0],address:o});break}}}catch{}else if(n[3]){let r=parseInt(n[3],10),o=t.tags[r];if(!o)continue;switch(o[0]){case"p":{e.push({text:n[0],profile:{pubkey:o[1],relays:o[2]?[o[2]]:[]}});break}case"e":{e.push({text:n[0],event:{id:o[1],relays:o[2]?[o[2]]:[]}});break}case"a":{try{let[s,i,a]=o[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:i,kind:parseInt(s,10),relays:o[2]?[o[2]]:[]}})}catch{}break}}}return e}var ws={};j(ws,{decrypt:()=>jl,encrypt:()=>bs});function bs(t,e,n){let r=t instanceof Uint8Array?D(t):t,o=Ct.getSharedSecret(r,"02"+e),s=ms(o),i=Uint8Array.from(Ve(16)),a=dt.encode(n),c=Fn(s,i).encrypt(a),l=at.encode(new Uint8Array(c)),f=at.encode(new Uint8Array(i.buffer));return`${l}?iv=${f}`}function jl(t,e,n){let r=t instanceof Uint8Array?D(t):t,[o,s]=n.split("?iv="),i=Ct.getSharedSecret(r,"02"+e),a=ms(i),c=at.decode(s),l=at.decode(o),f=Fn(a,c).decrypt(l);return Ut.decode(f)}function ms(t){return t.slice(1,33)}var xs={};j(xs,{NIP05_REGEX:()=>pr,isNip05:()=>zl,isValid:()=>Kl,queryProfile:()=>Es,searchDomain:()=>Wl,useFetchImplementation:()=>Dl});var pr=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,zl=t=>pr.test(t||""),hn;try{hn=fetch}catch{}function Dl(t){hn=t}async function Wl(t,e=""){try{let n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await hn(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Es(t){let e=t.match(pr);if(!e)return null;let[,n="_",r]=e;try{let o=`https://${r}/.well-known/nostr.json?name=${n}`,s=await hn(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");let i=await s.json(),a=i.names[n];return a?{pubkey:a,relays:i.relays?.[a]}:null}catch{return null}}async function Kl(t,e){let n=await Es(e);return n?n.pubkey===t:!1}var vs={};j(vs,{parse:()=>Zl});function Zl(t){let e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]},n,r;for(let o=t.tags.length-1;o>=0;o--){let s=t.tags[o];if(s[0]==="e"&&s[1]){let[i,a,c,l,f]=s,u={id:a,relays:c?[c]:[],author:f};if(l==="root"){e.root=u;continue}if(l==="reply"){e.reply=u;continue}if(l==="mention"){e.mentions.push(u);continue}n?r=u:n=u,e.mentions.push(u);continue}if(s[0]==="q"&&s[1]){let[i,a,c]=s;e.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(o=>{if(!o)return;let s=e.mentions.indexOf(o);if(s!==-1&&e.mentions.splice(s,1),o.author){let i=e.profiles.find(a=>a.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(a=>{o.relays?.indexOf(a)===-1&&o.relays.push(a)}),i.relays=o.relays)}}),e.mentions.forEach(o=>{if(o.author){let s=e.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),e}var As={};j(As,{fetchRelayInformation:()=>Jl,useFetchImplementation:()=>Gl});var Bs;try{Bs=fetch}catch{}function Gl(t){Bs=t}async function Jl(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Ss={};j(Ss,{fastEventHash:()=>Ts,getPow:()=>_s,minePow:()=>Xl});function _s(t){let e=0;for(let n=0;n<64;n+=8){let r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function Xl(t,e){let n=0,r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){let s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=Ts(r),_s(r.id)>=e)break}return r}function Ts(t){return D(it(dt.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var Ls={};j(Ls,{unwrapEvent:()=>af,unwrapManyEvents:()=>cf,wrapEvent:()=>zs,wrapManyEvents:()=>sf});var Is={};j(Is,{createRumor:()=>Ms,createSeal:()=>qs,createWrap:()=>Vs,unwrapEvent:()=>mr,unwrapManyEvents:()=>js,wrapEvent:()=>nn,wrapManyEvents:()=>rf});var ks={};j(ks,{decrypt:()=>br,encrypt:()=>wr,getConversationKey:()=>gr,v2:()=>ef});var Us=1,Rs=65535;function gr(t,e){let n=Ct.getSharedSecret(t,"02"+e).subarray(1,33);return No(it,n,"nip44-v2")}function Os(t,e){let n=Co(it,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function yr(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;let e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Yl(t){if(!Number.isSafeInteger(t)||t<Us||t>Rs)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function Fl(t){let e=dt.encode(t),n=e.length,r=Yl(n),o=new Uint8Array(yr(n)-n);return ae(r,e,o)}function Ql(t){let e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Us||e>Rs||n.length!==e||t.length!==2+yr(e))throw new Error("invalid padding");return Ut.decode(n)}function Ns(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=ae(n,e);return ue(it,t,r)}function tf(t){if(typeof t!="string")throw new Error("payload must be a valid string");let e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=at.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function wr(t,e,n=Ve(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=Os(e,n),i=Fl(t),a=Fe(r,o,i),c=Ns(s,a,n);return at.encode(ae(new Uint8Array([2]),n,a,c))}function br(t,e){let{nonce:n,ciphertext:r,mac:o}=tf(t),{chacha_key:s,chacha_nonce:i,hmac_key:a}=Os(e,n),c=Ns(a,r,n);if(!Yt(c,o))throw new Error("invalid MAC");let l=Fe(s,i,r);return Ql(l)}var ef={utils:{getConversationKey:gr,calcPaddedLen:yr},encrypt:wr,decrypt:br},nf=2880*60,Cs=()=>Math.round(Date.now()/1e3),Hs=()=>Math.round(Cs()-Math.random()*nf),Ps=(t,e)=>gr(t,e),$s=(t,e,n)=>wr(JSON.stringify(t),Ps(e,n)),Ho=(t,e)=>JSON.parse(br(t.content,Ps(e,t.pubkey)));function Ms(t,e){let n={created_at:Cs(),content:"",tags:[],...t,pubkey:sn(e)};return n.id=xe(n),n}function qs(t,e,n){return pt({kind:Go,content:$s(t,e,n),created_at:Hs(),tags:[]},e)}function Vs(t,e){let n=zo();return pt({kind:es,content:$s(t,n,e),created_at:Hs(),tags:[["p",e]]},n)}function nn(t,e,n){let r=Ms(t,e),o=qs(r,e,n);return Vs(o,n)}function rf(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");let r=sn(e),o=[nn(t,e,r)];return n.forEach(s=>{o.push(nn(t,e,s))}),o}function mr(t,e){let n=Ho(t,e);return Ho(n,e)}function js(t,e){let n=[];return t.forEach(r=>{n.push(mr(r,e))}),n.sort((r,o)=>r.created_at-o.created_at),n}function of(t,e,n,r){let o={created_at:Math.ceil(Date.now()/1e3),kind:Jo,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:i,relayUrl:a})=>{o.tags.push(a?["p",i,a]:["p",i])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function zs(t,e,n,r,o){let s=of(e,n,r,o);return nn(s,t,e.publicKey)}function sf(t,e,n,r,o){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:sn(t)},...e].map(i=>zs(t,i,n,r,o))}var af=mr,cf=js,Ds={};j(Ds,{finishRepostEvent:()=>lf,getRepostedEvent:()=>ff,getRepostedEventPointer:()=>Ws});function lf(t,e,n,r){let o,s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===Zo?o=ar:(o=lr,s.push(["k",String(e.kind)])),pt({kind:o,tags:s,content:t.content===""||e.tags?.find(i=>i[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function Ws(t){if(![ar,lr].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function ff(t,{skipVerification:e}={}){let n=Ws(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!de(r)))return r}var Ks={};j(Ks,{NOSTR_URI_REGEX:()=>xr,parse:()=>hf,test:()=>uf});var xr=new RegExp(`nostr:(${ys.source})`);function uf(t){return typeof t=="string"&&new RegExp(`^${xr.source}$`).test(t)}function hf(t){let e=t.match(new RegExp(`^${xr.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Ee(e[1])}}var Zs={};j(Zs,{finishReactionEvent:()=>df,getReactedEventPointer:()=>pf});function df(t,e,n){let r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return pt({...t,kind:cr,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function pf(t){if(t.kind!==cr)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Gs={};j(Gs,{parse:()=>yf});var Po=/\W/m,$o=/[^\w\/] |[^\w\/]$|$|,| /m,gf=42;function*yf(t){let e=[];if(typeof t!="string"){for(let s=0;s<t.tags.length;s++){let i=t.tags[s];i[0]==="emoji"&&i.length>=3&&e.push({type:"emoji",shortcode:i[1],url:i[2]})}t=t.content}let n=t.length,r=0,o=0;t:for(;o<n;){let s=t.indexOf(":",o),i=t.indexOf("#",o);if(s===-1&&i===-1)break t;if(s===-1||i>=0&&i<s){if(i===0||t[i-1]===" "){let a=t.slice(i+1,i+gf).match(Po),c=a?i+1+a.index:n;yield{type:"text",text:t.slice(r,i)},yield{type:"hashtag",value:t.slice(i+1,c)},o=c,r=o;continue t}o=i+1;continue t}if(t.slice(s-5,s)==="nostr"){let a=t.slice(s+60).match(Po),c=a?s+60+a.index:n;try{let l,{data:f,type:u}=Ee(t.slice(s+1,c));switch(u){case"npub":l={pubkey:f};break;case"note":l={id:f};break;case"nsec":o=c+1;continue;default:l=f}r!==s-5&&(yield{type:"text",text:t.slice(r,s-5)}),yield{type:"reference",pointer:l},o=c,r=o;continue t}catch{o=s+1;continue t}}else if(t.slice(s-5,s)==="https"||t.slice(s-4,s)==="http"){let a=t.slice(s+4).match($o),c=a?s+4+a.index:n,l=t[s-1]==="s"?5:4;try{let f=new URL(t.slice(s-l,c));if(f.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==s-l&&(yield{type:"text",text:t.slice(r,s-l)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(f.pathname)){yield{type:"image",url:f.toString()},o=c,r=o;continue t}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(f.pathname)){yield{type:"video",url:f.toString()},o=c,r=o;continue t}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(f.pathname)){yield{type:"audio",url:f.toString()},o=c,r=o;continue t}yield{type:"url",url:f.toString()},o=c,r=o;continue t}catch{o=c+1;continue t}}else if(t.slice(s-3,s)==="wss"||t.slice(s-2,s)==="ws"){let a=t.slice(s+4).match($o),c=a?s+4+a.index:n,l=t[s-1]==="s"?3:2;try{let f=new URL(t.slice(s-l,c));if(f.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==s-l&&(yield{type:"text",text:t.slice(r,s-l)}),yield{type:"relay",url:f.toString()},o=c,r=o;continue t}catch{o=c+1;continue t}}else{for(let a=0;a<e.length;a++){let c=e[a];if(t[s+c.shortcode.length+1]===":"&&t.slice(s+1,s+c.shortcode.length+1)===c.shortcode){r!==s&&(yield{type:"text",text:t.slice(r,s)}),yield c,o=s+c.shortcode.length+2,r=o;continue t}}o=s+1;continue t}}r!==n&&(yield{type:"text",text:t.slice(r)})}var Js={};j(Js,{channelCreateEvent:()=>wf,channelHideMessageEvent:()=>xf,channelMessageEvent:()=>mf,channelMetadataEvent:()=>bf,channelMuteUserEvent:()=>Ef});var wf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pt({kind:Xo,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},bf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pt({kind:Yo,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},mf=(t,e)=>{let n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),pt({kind:Fo,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},xf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pt({kind:Qo,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Ef=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pt({kind:ts,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},Xs={};j(Xs,{EMOJI_SHORTCODE_REGEX:()=>Ys,matchAll:()=>vf,regex:()=>Er,replaceAll:()=>Af});var Ys=/:(\w+):/,Er=()=>new RegExp(`\\B${Ys.source}\\B`,"g");function*vf(t){let e=t.matchAll(Er());for(let n of e)try{let[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Af(t,e){return t.replaceAll(Er(),(n,r)=>e({shortcode:n,name:r}))}var Fs={};j(Fs,{useFetchImplementation:()=>Bf,validateGithub:()=>Sf});var vr;try{vr=fetch}catch{}function Bf(t){vr=t}async function Sf(t,e,n){try{return await(await vr(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var Qs={};j(Qs,{makeNwcRequestEvent:()=>Tf,parseConnectionString:()=>_f});function _f(t){let{host:e,pathname:n,searchParams:r}=new URL(t),o=n||e,s=r.get("relay"),i=r.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function Tf(t,e,n){let o=bs(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:rs,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return pt(s,e)}var ti={};j(ti,{normalizeIdentifier:()=>Lf});function Lf(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>/\p{Letter}/u.test(e)||/\p{Number}/u.test(e)?e:"-").join("")}var ei={};j(ei,{getSatoshisAmountFromBolt11:()=>Nf,getZapEndpoint:()=>kf,makeZapReceipt:()=>Of,makeZapRequest:()=>Uf,useFetchImplementation:()=>If,validateZapRequest:()=>Rf});var Ar;try{Ar=fetch}catch{}function If(t){Ar=t}async function kf(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(r){let[i,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else if(n){let{words:i}=qt.decode(n,1e3),a=qt.fromWords(i);e=Ut.decode(a)}else return null;let s=await(await Ar(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function Uf(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),an(t.event.kind)){let n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(cn(t.event.kind)){let n=t.event.tags.find(([o,s])=>o==="d"&&s);if(!n)throw new Error("d tag not found or is empty");let r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function Rf(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!rn(e))return"Zap request is not a valid Nostr event.";if(!de(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function Of({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}function Nf(t){if(t.length<50)return 0;t=t.substring(0,50);let e=t.lastIndexOf("1");if(e===-1)return 0;let n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;let r=n.substring(4);if(r.length<1)return 0;let o=r[r.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9,a=r.length-1;if(i&&a++,a<1)return 0;let c=parseInt(r.substring(0,a));switch(o){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var ni={};j(ni,{Negentropy:()=>oi,NegentropyStorageVector:()=>Pf,NegentropySync:()=>$f});var or=97,he=32,ri=16,Qt={Skip:0,Fingerprint:1,IdList:2},kt=class{_raw;length;constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t instanceof Uint8Array?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(t){if(t instanceof kt&&(t=t.unwrap()),typeof t.length!="number")throw Error("bad length");let e=t.length+this.length;if(this.capacity<e){let n=this._raw,r=Math.max(this.capacity*2,e);this._raw=new Uint8Array(r),this._raw.set(n)}this._raw.set(t,this.length),this.length+=t.length}shift(){let t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t=1){let e=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,e}};function tn(t){let e=0;for(;;){if(t.length===0)throw Error("parse ends prematurely");let n=t.shift();if(e=e<<7|n&127,(n&128)===0)break}return e}function It(t){if(t===0)return new kt(new Uint8Array([0]));let e=[];for(;t!==0;)e.push(t&127),t>>>=7;e.reverse();for(let n=0;n<e.length-1;n++)e[n]|=128;return new kt(new Uint8Array(e))}function Cf(t){return en(t,1)[0]}function en(t,e){if(t.length<e)throw Error("parse ends prematurely");return t.shiftN(e)}var Hf=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(he)}add(t){let e=0,n=0,r=new DataView(this.buf.buffer),o=new DataView(t.buffer);for(let s=0;s<8;s++){let i=s*4,a=r.getUint32(i,!0),c=o.getUint32(i,!0),l=a;l+=e,l+=c,l>4294967295&&(n=1),r.setUint32(i,l&4294967295,!0),e=n,n=0}}negate(){let t=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let r=n*4;t.setUint32(r,~t.getUint32(r,!0))}let e=new Uint8Array(he);e[0]=1,this.add(e)}getFingerprint(t){let e=new kt;return e.extend(this.buf),e.extend(It(t)),it(e.unwrap()).subarray(0,ri)}},Pf=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(t,e){if(this.sealed)throw Error("already sealed");let n=zn(e);if(n.byteLength!==he)throw Error("bad id size for added item");this.items.push({timestamp:t,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(sr);for(let t=1;t<this.items.length;t++)if(sr(this.items[t-1],this.items[t])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(t){if(this._checkSealed(),t>=this.items.length)throw Error("out of range");return this.items[t]}iterate(t,e,n){this._checkSealed(),this._checkBounds(t,e);for(let r=t;r<e&&n(this.items[r],r);++r);}findLowerBound(t,e,n){return this._checkSealed(),this._checkBounds(t,e),this._binarySearch(this.items,t,e,r=>sr(r,n)<0)}fingerprint(t,e){let n=new Hf;return n.setToZero(),this.iterate(t,e,r=>(n.add(r.id),!0)),n.getFingerprint(e-t)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(t,e){if(t>e||e>this.items.length)throw Error("bad range")}_binarySearch(t,e,n,r){let o=n-e;for(;o>0;){let s=e,i=Math.floor(o/2);s+=i,r(t[s])?(e=++s,o-=i+1):o=i}return e}},oi=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(t,e=6e4){if(e<4096)throw Error("frameSizeLimit too small");this.storage=t,this.frameSizeLimit=e,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(t,e){return{timestamp:t,id:e||new Uint8Array(0)}}initiate(){let t=new kt;return t.extend(new Uint8Array([or])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),t),Xt(t.unwrap())}reconcile(t,e,n){let r=new kt(zn(t));this.lastTimestampIn=this.lastTimestampOut=0;let o=new kt;o.extend(new Uint8Array([or]));let s=Cf(r);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==or)throw Error("unsupported negentropy protocol version requested: "+(s-96));let i=this.storage.size(),a=this._bound(0),c=0,l=!1;for(;r.length!==0;){let f=new kt,u=()=>{l&&(l=!1,f.extend(this.encodeBound(a)),f.extend(It(Qt.Skip)))},p=this.decodeBound(r),y=tn(r),g=c,h=this.storage.findLowerBound(c,i,p);if(y===Qt.Skip)l=!0;else if(y===Qt.Fingerprint){let d=en(r,ri),w=this.storage.fingerprint(g,h);si(d,w)!==0?(u(),this.splitRange(g,h,p,f)):l=!0}else if(y===Qt.IdList){let d=tn(r),w={};for(let b=0;b<d;b++){let x=en(r,he);w[Xt(x)]=x}if(l=!0,this.storage.iterate(g,h,b=>{let x=b.id,A=Xt(x);return w[A]?delete w[Xt(x)]:e?.(A),!0}),n)for(let b of Object.values(w))n(Xt(b))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(o.length+f.length)){let d=this.storage.fingerprint(h,i);o.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),o.extend(It(Qt.Fingerprint)),o.extend(d);break}else o.extend(f);c=h,a=p}return o.length===1?null:Xt(o.unwrap())}splitRange(t,e,n,r){let o=e-t,s=16;if(o<s*2)r.extend(this.encodeBound(n)),r.extend(It(Qt.IdList)),r.extend(It(o)),this.storage.iterate(t,e,i=>(r.extend(i.id),!0));else{let i=Math.floor(o/s),a=o%s,c=t;for(let l=0;l<s;l++){let f=i+(l<a?1:0),u=this.storage.fingerprint(c,c+f);c+=f;let p;if(c===e)p=n;else{let y,g;this.storage.iterate(c-1,c+1,(h,d)=>(d===c-1?y=h:g=h,!0)),p=this.getMinimalBound(y,g)}r.extend(this.encodeBound(p)),r.extend(It(Qt.Fingerprint)),r.extend(u)}}}exceededFrameSizeLimit(t){return t>this.frameSizeLimit-200}decodeTimestampIn(t){let e=tn(t);return e=e===0?Number.MAX_VALUE:e-1,this.lastTimestampIn===Number.MAX_VALUE||e===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(e+=this.lastTimestampIn,this.lastTimestampIn=e,e)}decodeBound(t){let e=this.decodeTimestampIn(t),n=tn(t);if(n>he)throw Error("bound key too long");let r=en(t,n);return{timestamp:e,id:r}}encodeTimestampOut(t){if(t===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,It(0);let e=t;return t-=this.lastTimestampOut,this.lastTimestampOut=e,It(t+1)}encodeBound(t){let e=new kt;return e.extend(this.encodeTimestampOut(t.timestamp)),e.extend(It(t.id.length)),e.extend(t.id),e}getMinimalBound(t,e){if(e.timestamp!==t.timestamp)return this._bound(e.timestamp);{let n=0,r=e.id,o=t.id;for(let s=0;s<he&&r[s]===o[s];s++)n++;return this._bound(e.timestamp,e.id.subarray(0,n+1))}}};function si(t,e){for(let n=0;n<t.byteLength;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}function sr(t,e){return t.timestamp===e.timestamp?si(t.id,e.id):t.timestamp-e.timestamp}var $f=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(t,e,n,r={}){this.relay=t,this.storage=e,this.neg=new oi(e),this.onhave=r.onhave,this.onneed=r.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:r.label||"negentropy"}),this.subscription.oncustom=o=>{switch(o[0]){case"NEG-MSG":{o.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${o}`);try{let s=this.neg.reconcile(o[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),r.onclose?.())}catch(s){console.error("negentropy reconcile error:",s),r?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{let s=o[2];console.warn("negentropy error:",s),r.onclose?.(s);break}case"NEG-ERR":r.onclose?.()}}}async start(){let t=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${t}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},ii={};j(ii,{getToken:()=>Mf,hashPayload:()=>Br,unpackEventFromToken:()=>ci,validateEvent:()=>pi,validateEventKind:()=>fi,validateEventMethodTag:()=>hi,validateEventPayloadTag:()=>di,validateEventTimestamp:()=>li,validateEventUrlTag:()=>ui,validateToken:()=>qf});var ai="Nostr ";async function Mf(t,e,n,r=!1,o){let s={kind:fr,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Br(o)]);let i=await n(s);return(r?ai:"")+at.encode(dt.encode(JSON.stringify(i)))}async function qf(t,e,n){let r=await ci(t).catch(s=>{throw s});return await pi(r,e,n).catch(s=>{throw s})}async function ci(t){if(!t)throw new Error("Missing token");t=t.replace(ai,"");let e=Ut.decode(at.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function li(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function fi(t){return t.kind===fr}function ui(t,e){let n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function hi(t,e){let n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function Br(t){let e=it(dt.encode(JSON.stringify(t)));return D(e)}function di(t,e){let n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;let r=Br(e);return n.length>0&&n[1]===r}async function pi(t,e,n,r){if(!de(t))throw new Error("Invalid nostr event, signature invalid");if(!fi(t))throw new Error("Invalid nostr event, kind invalid");if(!li(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ui(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!hi(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!di(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}return mi(Vf);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
